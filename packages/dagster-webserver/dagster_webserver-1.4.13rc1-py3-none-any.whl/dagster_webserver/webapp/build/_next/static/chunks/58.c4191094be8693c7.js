"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58],{58:function(e,n,t){t.r(n),t.d(n,{RunRoot:function(){return ey},default:function(){return ej}});var i=t(73235),r=t(52322),o=t(40794),s=t(60138),a=t(2736),l=t(62540),u=t(19369),c=t(94901),d=t(42033),p=t(17577),f=t(45),h=t(2784),m=t(7267),x=t(61893),v=t(48608),g=t(28292),y=t(82550),j=t(87323),S=t(4804),w=t(88528),I=t(47933),b=t(50292),T=new Intl.Collator(navigator.language,{sensitivity:"base"}),_=function(e){var n=e.assetKeys,t=e.evaluationId,i=h.useMemo(function(){return(0,y._)(n).sort(function(e,n){return T.compare(e.path.join("/"),n.path.join("/"))})},[n]);return(0,r.jsx)(p.J,{placement:"bottom",content:(0,r.jsxs)("div",{style:{width:"340px"},children:[(0,r.jsx)(a.x,{padding:{vertical:8,horizontal:12},border:{side:"bottom",width:1,color:j.w.KeylineGray},style:{fontWeight:600},children:"Auto-materialized"}),(0,r.jsx)(a.x,{flex:{direction:"column",gap:12},padding:{vertical:12},style:{maxHeight:"220px",overflowY:"auto"},children:i.map(function(e){var n=(0,b.p)(e,{view:"auto-materialize-history",evaluation:t});return(0,r.jsxs)(a.x,{padding:{vertical:8,left:12,right:16},flex:{direction:"row",justifyContent:"space-between",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,r.jsxs)(a.x,{flex:{direction:"row",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,r.jsx)(S.JO,{name:"asset"}),(0,r.jsx)(w.g,{text:e.path.join("/")})]}),(0,r.jsx)(I.rU,{to:n,style:{whiteSpace:"nowrap"},children:"View evaluation"})]},n)})})]}),interactionKind:"hover",children:(0,r.jsx)(d.V,{icon:"auto_materialize_policy",children:"Auto-materialized"})})},K=t(34503),R=t(24651),F=t(30082),k=t(33667),E=t(61018),O=t(19041),C=t(97350),N=t(85333),A=t(6692),L=t(58467),V=t(49363),z=t(8504),D=t(35505),J=t(8848),Q=t(33467),U=t(14590),q=t(1258),P=t(5500),M=t(7334),W=function(e){h.useEffect(function(){var n=document.querySelector('link[rel="icon"][type="image/svg+xml"]');if(n){var t=n.getAttribute("href");return n.setAttribute("href",e),function(){t&&n.setAttribute("href",t)}}},[e])},G=t(76358),B=t(52427),H=t(3553),Z=t(43576),X=t(13729),$=t(71135),Y=t(97741),ee=t(77959),en=t(37416),et=t(50027),ei=t(29330),er=t(79062),eo=t(52024);function es(){var e=(0,i._)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n"]);return es=function(){return e},e}var ea=function(e){switch(e){case M.VOA.FAILURE:return"/favicon-run-failed.svg";case M.VOA.SUCCESS:return"/favicon-run-success.svg";case M.VOA.STARTING:case M.VOA.STARTED:case M.VOA.CANCELING:return"/favicon-run-pending.svg";default:return"/favicon.svg"}},el=function(e){var n=e.run,t=e.runId,i=(0,L._)((0,eo.Bz)(),2),o=i[0],s=i[1],a=(0,L._)((0,G.q)({queryKey:"selection",defaults:{selection:""}}),2),l=a[0],u=a[1];W(n?ea(n.status):"/favicon.svg"),(0,K.j)(n?"".concat((0,g.pv)(n.pipelineName)?"":n.pipelineName," ").concat(t.slice(0,8)," [").concat(n.status,"]"):"Run: ".concat(t));var c=function(e,n){var t=n.find(function(n){return"ExecutionStepFailureEvent"===n.__typename&&n.stepKey===e});t&&(0,J._)({body:(0,r.jsx)(U.T9,{error:t})})},d=function(e){u(e),s((0,A._)((0,N._)({},o),{logQuery:"*"!==e?[{token:"query",value:e}]:[]}))};return(0,r.jsx)(en.A.Provider,{value:n,children:(0,r.jsx)(X.C,{runId:t,children:function(e){return(0,r.jsx)(et.jp,{logs:e,children:function(i){return(0,r.jsx)(ec,{run:n,runId:t,logs:e,logsFilter:o,metadata:i,selectionQuery:l,onSetLogsFilter:s,onSetSelectionQuery:d,onShowStateDetails:c})}})}},t)})},eu=function(e){switch(e){case"stdout":return Y.hi.stdout;case"stderr":return Y.hi.stderr;default:return Y.hi.structured}},ec=function(e){var n=e.run,t=e.runId,i=e.logs,o=e.logsFilter,s=e.metadata,l=e.selectionQuery,u=e.onSetLogsFilter,c=e.onSetSelectionQuery,d=(0,er.W)(n),p=h.createRef(),m=(0,L._)((0,G.q)({queryKey:"logType",defaults:{logType:Y.hi.stderr}}),2),x=m[0],v=m[1],g=eu(x),j=(0,L._)(h.useState(null),2),S=j[0],w=j[1],I=JSON.stringify(Object.keys(s.steps).sort()),b=h.useMemo(function(){return JSON.parse(I)},[I]),T=(null==n?void 0:n.executionPlan)&&(0,P.J)(null==n?void 0:n.executionPlan,s.steps),_=h.useMemo(function(){return T&&l&&"*"!==l?(0,Q.V)(T,l).all.map(function(e){return e.name}):[]},[T,l]),K=(0,B.a)(),R=(0,ei.r)({stepKeys:b,selectionStepKeys:_,metadata:s,defaultToFirstStep:!1}),F=R.logCaptureInfo,k=R.computeLogFileKey,E=R.setComputeLogFileKey,O=T?o.logQuery.filter(function(e){return e.token&&"query"===e.token}).reduce(function(e,n){return(0,y._)(e).concat((0,y._)((0,Q.V)(T,n.value).all.map(function(e){return e.name})))},[]):[];return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(z.OS,{ref:p,axis:"vertical",identifier:"run-gantt",firstInitialPercent:35,firstMinSize:56,first:n?"QUEUED"===n.status?(0,r.jsx)(q.Fu,{run:n}):n.executionPlan&&T?(0,r.jsx)(V.S,{region:"gantt chart",children:(0,r.jsx)(q.hj,{options:{mode:q.hS.WATERFALL_TIMED},toolbarActions:(0,r.jsxs)(a.x,{flex:{direction:"row",alignItems:"center",gap:12},children:[(0,r.jsx)(z.jo,{axis:"vertical",container:p}),(0,r.jsx)(ee.NX,{run:n,onLaunch:d,graph:T,metadata:s,selection:{query:l,keys:_}})]}),runId:t,graph:T,metadata:s,selection:{query:l,keys:_},onClickStep:function(e,n){var t,i=_.indexOf(e),r='"'.concat(e,'"');if(n.shiftKey)t=(0,y._)(_.map(function(e){return l.includes('"'.concat(e,'"'))?'"'.concat(e,'"'):e})),-1!==i?t.splice(i,1):t.push(r);else if(1===_.length&&-1!==i)t=[];else{t=[r];var o=(0,ei.c)(s.logCaptureSteps,e);o&&E(o)}c(t.join(", ")||"*")},onSetSelection:c,focusedTime:o.focusedTime})}):(0,r.jsx)(f.t,{icon:"error",title:"Unable to build execution plan"}):(0,r.jsx)(q.ZW,{runId:t}),second:(0,r.jsx)(V.S,{region:"logs",children:(0,r.jsxs)(ed,{children:[(0,r.jsx)(Y.KZ,{logType:g,onSetLogType:function(e){return v(Y.hi[e])},filter:o,onSetFilter:u,steps:b,metadata:s,computeLogFileKey:k,onSetComputeLogKey:E,computeLogUrl:S,counts:i.counts}),g!==Y.hi.structured?k?K?(0,r.jsx)(H.h,{logKey:k?[t,"compute_logs",k]:[],logCaptureInfo:F,visibleIOType:Y.hi[g],onSetDownloadUrl:w}):(0,r.jsx)(Z.K,{runId:t,computeLogFileKey:b.length?k:void 0,ioType:Y.hi[g],setComputeLogUrl:w}):(0,r.jsx)(ep,{type:g}):(0,r.jsx)($.S,{logs:i,filter:o,filterStepKeys:O,filterKey:"".concat(JSON.stringify(o)),metadata:s})]})})})})},ed=D.ZP.div.withConfig({componentId:"sc-ed4002cc-0"})(es()),ep=function(e){var n=e.type;return(0,r.jsx)(a.x,{flex:{direction:"row",grow:1,alignItems:"center",justifyContent:"center"},style:{background:"#221F1B"},children:(0,r.jsx)(f.t,{title:"Select a step to view ".concat(n),icon:"warning",description:"Select a step on the Gantt chart or from the dropdown above to view logs."})})},ef=t(486),eh=t(54095),em=t(50743),ex=t(29545),ev=t(83221);function eg(){var e=(0,i._)(["\n  query RunRootQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        ...RunPageFragment\n      }\n    }\n  }\n\n  ","\n"]);return eg=function(){return e},e}var ey=function(){(0,v.Px)();var e,n=(0,m.UO)().runId;(0,K.j)(n?"Run ".concat(n.slice(0,8)):"Run");var t=(0,o.a)(ew,{variables:{runId:n}}),i=t.data,s=t.loading,f=(null==i?void 0:i.pipelineRunOrError.__typename)==="Run"?i.pipelineRunOrError:null,y=null==f?void 0:f.pipelineSnapshotId,j=(0,O.n)(f),S=(null==j?void 0:j.match)?(0,E.kQ)(j.match.repository.name,j.match.repositoryLocation.name):null,w=h.useMemo(function(){return!!(f&&j&&(0,k.E8)(j.match,f.pipelineName))},[f,j]),I=h.useMemo(function(){return(null==f?void 0:f.tags.find(function(e){return e.key===ex.H.AssetEvaluationID}))||null},[f]);return(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",minWidth:0,width:"100%",height:"100%",overflow:"hidden"},children:[(0,r.jsx)(a.x,{flex:{direction:"row",alignItems:"flex-start"},style:{position:"relative",zIndex:1},children:(0,r.jsx)(l.m,{title:(0,r.jsx)(u.X6,{style:{fontFamily:c.b.monospace,fontSize:"20px"},children:n.slice(0,8)}),tags:f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(em.KG,{status:f.status}),(0,g.pv)(f.pipelineName)?(0,r.jsx)(C.m,{assetKeys:(0,ev.Bo)(f),useTags:!0}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(d.V,{icon:"run",children:["Run of"," ",(0,r.jsx)(R.h,{pipelineName:null==f?void 0:f.pipelineName,pipelineHrefContext:S||"repo-unknown",snapshotId:y,size:"small",isJob:w})]}),(0,r.jsx)(C.m,{assetKeys:f.assets.map(function(e){return e.key}),useTags:!0})]}),(0,r.jsxs)(a.x,{flex:{direction:"row",alignItems:"flex-start",gap:12,wrap:"wrap"},children:[(null==f?void 0:f.startTime)?(0,r.jsx)(p.J,{interactionKind:"hover",placement:"bottom",content:(0,r.jsx)(a.x,{padding:16,children:(0,r.jsx)(ef.lc,{run:f,loading:s})}),children:(0,r.jsx)(d.V,{icon:"schedule",children:(0,r.jsx)(F.v,{timestamp:f.startTime,timeFormat:{showSeconds:!0,showTimezone:!1}})})}):f.updateTime?(0,r.jsx)(d.V,{icon:"schedule",children:(0,r.jsx)(F.v,{timestamp:f.updateTime,timeFormat:{showSeconds:!0,showTimezone:!1}})}):void 0,(null==f?void 0:f.startTime)&&(null==f?void 0:f.endTime)?(0,r.jsx)(p.J,{interactionKind:"hover",placement:"bottom",content:(0,r.jsx)(a.x,{padding:16,children:(0,r.jsx)(ef.lc,{run:f,loading:s})}),children:(0,r.jsx)(d.V,{icon:"timer",children:(0,r.jsx)("span",{style:{fontVariantNumeric:"tabular-nums"},children:(null==f?void 0:f.startTime)?(0,x.fv)(((null==f?void 0:f.endTime)*1e3||Date.now())-(null==f?void 0:f.startTime)*1e3):"â€“"})})}):null,I&&(null===(e=f.assetSelection)||void 0===e?void 0:e.length)?(0,r.jsx)(_,{assetKeys:f.assetSelection,evaluationId:I.value}):null]})]}):null,right:f?(0,r.jsx)(ef.Up,{run:f,isJob:w}):null})}),(0,r.jsx)(eS,{data:i,runId:n})]})},ej=ey,eS=function(e){var n=e.data,t=e.runId;return n&&n.pipelineRunOrError?"Run"!==n.pipelineRunOrError.__typename?(0,r.jsx)(a.x,{padding:{vertical:64},children:(0,r.jsx)(f.t,{icon:"error",title:"No run found",description:"The run with this ID does not exist or has been cleaned up."})}):(0,r.jsx)(el,{run:n.pipelineRunOrError,runId:t}):(0,r.jsx)(el,{run:void 0,runId:t})},ew=(0,s.Ps)(eg(),eh.tQ)},79062:function(e,n,t){t.d(n,{W:function(){return p}});var i=t(81862),r=t(58467),o=t(22970),s=t(33379),a=t(2784),l=t(7267),u=t(30404),c=t(19041),d=t(83221),p=function(e){var n,t=(0,l.k6)(),p=(0,r._)((0,s.D)(d.kO),1)[0],f=(0,c.n)(e);return a.useCallback((n=(0,i._)(function(n){var i,r,s,a;return(0,o.Jh)(this,function(o){switch(o.label){case 0:if(!e||!e.pipelineSnapshotId||!f)return[2];i=(0,d.kz)({run:e,style:n,repositoryLocationName:f.match.repositoryLocation.name,repositoryName:f.match.repository.name}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,p({variables:i})];case 2:return s=o.sent(),(0,d.lF)(e.pipelineName,null===(r=s.data)||void 0===r?void 0:r.launchPipelineReexecution,t,{preserveQuerystring:!0,behavior:"open"}),[3,4];case 3:return a=o.sent(),(0,u.t)(a),[3,4];case 4:return[2]}})}),function(e){return n.apply(this,arguments)}),[t,p,f,e])}}}]);
//# sourceMappingURL=58.c4191094be8693c7.js.map