var ye,T,Je,z,Ae,qe,ke,ze,X={},Ye=[],ht=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Oe=Array.isArray;function q(e,t){for(var n in t)e[n]=t[n];return e}function De(e){var t=e.parentNode;t&&t.removeChild(e)}function mt(e,t,n){var l,a,o,c={};for(o in t)o=="key"?l=t[o]:o=="ref"?a=t[o]:c[o]=t[o];if(arguments.length>2&&(c.children=arguments.length>3?ye.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)c[o]===void 0&&(c[o]=e.defaultProps[o]);return ie(e,c,l,a,null)}function ie(e,t,n,l,a){var o={type:e,props:t,key:n,ref:l,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:a??++Je};return a==null&&T.vnode!=null&&T.vnode(o),o}function yt(){return{current:null}}function V(e){return e.children}function ce(e,t){this.props=e,this.context=t}function _e(e,t){if(t==null)return e.__?_e(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?_e(e):null}function Qe(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Qe(e)}}function we(e){(!e.__d&&(e.__d=!0)&&z.push(e)&&!pe.__r++||Ae!==T.debounceRendering)&&((Ae=T.debounceRendering)||qe)(pe)}function pe(){var e,t,n,l,a,o,c,u,d;for(z.sort(ke);e=z.shift();)e.__d&&(t=z.length,l=void 0,a=void 0,o=void 0,u=(c=(n=e).__v).__e,(d=n.__P)&&(l=[],a=[],(o=q({},c)).__v=c.__v+1,je(d,c,o,n.__n,d.ownerSVGElement!==void 0,c.__h!=null?[u]:null,l,u??_e(c),c.__h,a),tt(l,c,a),c.__e!=u&&Qe(c)),z.length>t&&z.sort(ke));pe.__r=0}function Xe(e,t,n,l,a,o,c,u,d,s,b){var i,m,g,_,p,k,v,f,h,y,w=0,j=l&&l.__k||Ye,E=j.length,U=E,N=t.length;for(n.__k=[],i=0;i<N;i++)(_=n.__k[i]=(_=t[i])==null||typeof _=="boolean"||typeof _=="function"?null:typeof _=="string"||typeof _=="number"||typeof _=="bigint"?ie(null,_,null,null,_):Oe(_)?ie(V,{children:_},null,null,null):_.__b>0?ie(_.type,_.props,_.key,_.ref?_.ref:null,_.__v):_)!=null&&(_.__=n,_.__b=n.__b+1,(f=bt(_,j,v=i+w,U))===-1?g=X:(g=j[f]||X,j[f]=void 0,U--),je(e,_,g,a,o,c,u,d,s,b),p=_.__e,(m=_.ref)&&g.ref!=m&&(g.ref&&Ne(g.ref,null,_),b.push(m,_.__c||p,_)),p!=null&&(k==null&&(k=p),y=!(h=g===X||g.__v===null)&&f===v,h?f==-1&&w--:f!==v&&(f===v+1?(w++,y=!0):f>v?U>N-v?(w+=f-v,y=!0):w--:w=f<v&&f==v-1?f-v:0),v=i+w,y=y||f==i&&!h,typeof _.type!="function"||f===v&&g.__k!==_.__k?typeof _.type=="function"||y?_.__d!==void 0?(d=_.__d,_.__d=void 0):d=p.nextSibling:d=et(e,p,d):d=Ze(_,d,e),typeof n.type=="function"&&(n.__d=d)));for(n.__e=k,i=E;i--;)j[i]!=null&&(typeof n.type=="function"&&j[i].__e!=null&&j[i].__e==n.__d&&(n.__d=j[i].__e.nextSibling),nt(j[i],j[i]))}function Ze(e,t,n){for(var l,a=e.__k,o=0;a&&o<a.length;o++)(l=a[o])&&(l.__=e,t=typeof l.type=="function"?Ze(l,t,n):et(n,l.__e,t));return t}function et(e,t,n){return n==null||n.parentNode!==e?e.insertBefore(t,null):t==n&&t.parentNode!=null||e.insertBefore(t,n),t.nextSibling}function bt(e,t,n,l){var a=e.key,o=e.type,c=n-1,u=n+1,d=t[n];if(d===null||d&&a==d.key&&o===d.type)return n;if(l>(d!=null?1:0))for(;c>=0||u<t.length;){if(c>=0){if((d=t[c])&&a==d.key&&o===d.type)return c;c--}if(u<t.length){if((d=t[u])&&a==d.key&&o===d.type)return u;u++}}return-1}function gt(e,t,n,l,a){var o;for(o in n)o==="children"||o==="key"||o in t||fe(e,o,null,n[o],l);for(o in t)a&&typeof t[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||n[o]===t[o]||fe(e,o,t[o],n[o],l)}function Pe(e,t,n){t[0]==="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||ht.test(t)?n:n+"px"}function fe(e,t,n,l,a){var o;e:if(t==="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof l=="string"&&(e.style.cssText=l=""),l)for(t in l)n&&t in n||Pe(e.style,t,"");if(n)for(t in n)l&&n[t]===l[t]||Pe(e.style,t,n[t])}else if(t[0]==="o"&&t[1]==="n")o=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?l||e.addEventListener(t,o?Ue:Le,o):e.removeEventListener(t,o?Ue:Le,o);else if(t!=="dangerouslySetInnerHTML"){if(a)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!=="width"&&t!=="height"&&t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t!=="rowSpan"&&t!=="colSpan"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!=="-"?e.removeAttribute(t):e.setAttribute(t,n))}}function Le(e){return this.l[e.type+!1](T.event?T.event(e):e)}function Ue(e){return this.l[e.type+!0](T.event?T.event(e):e)}function je(e,t,n,l,a,o,c,u,d,s){var b,i,m,g,_,p,k,v,f,h,y,w,j,E,U,N=t.type;if(t.constructor!==void 0)return null;n.__h!=null&&(d=n.__h,u=t.__e=n.__e,t.__h=null,o=[u]),(b=T.__b)&&b(t);try{e:if(typeof N=="function"){if(v=t.props,f=(b=N.contextType)&&l[b.__c],h=b?f?f.props.value:b.__:l,n.__c?k=(i=t.__c=n.__c).__=i.__E:("prototype"in N&&N.prototype.render?t.__c=i=new N(v,h):(t.__c=i=new ce(v,h),i.constructor=N,i.render=$t),f&&f.sub(i),i.props=v,i.state||(i.state={}),i.context=h,i.__n=l,m=i.__d=!0,i.__h=[],i._sb=[]),i.__s==null&&(i.__s=i.state),N.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=q({},i.__s)),q(i.__s,N.getDerivedStateFromProps(v,i.__s))),g=i.props,_=i.state,i.__v=t,m)N.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(N.getDerivedStateFromProps==null&&v!==g&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(v,h),!i.__e&&(i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(v,i.__s,h)===!1||t.__v===n.__v)){for(t.__v!==n.__v&&(i.props=v,i.state=i.__s,i.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.forEach(function(F){F&&(F.__=t)}),y=0;y<i._sb.length;y++)i.__h.push(i._sb[y]);i._sb=[],i.__h.length&&c.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(v,i.__s,h),i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(g,_,p)})}if(i.context=h,i.props=v,i.__P=e,i.__e=!1,w=T.__r,j=0,"prototype"in N&&N.prototype.render){for(i.state=i.__s,i.__d=!1,w&&w(t),b=i.render(i.props,i.state,i.context),E=0;E<i._sb.length;E++)i.__h.push(i._sb[E]);i._sb=[]}else do i.__d=!1,w&&w(t),b=i.render(i.props,i.state,i.context),i.state=i.__s;while(i.__d&&++j<25);i.state=i.__s,i.getChildContext!=null&&(l=q(q({},l),i.getChildContext())),m||i.getSnapshotBeforeUpdate==null||(p=i.getSnapshotBeforeUpdate(g,_)),Xe(e,Oe(U=b!=null&&b.type===V&&b.key==null?b.props.children:b)?U:[U],t,n,l,a,o,c,u,d,s),i.base=t.__e,t.__h=null,i.__h.length&&c.push(i),k&&(i.__E=i.__=null)}else o==null&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=vt(n.__e,t,n,l,a,o,c,d,s);(b=T.diffed)&&b(t)}catch(F){t.__v=null,(d||o!=null)&&(t.__e=u,t.__h=!!d,o[o.indexOf(u)]=null),T.__e(F,t,n)}}function tt(e,t,n){for(var l=0;l<n.length;l++)Ne(n[l],n[++l],n[++l]);T.__c&&T.__c(t,e),e.some(function(a){try{e=a.__h,a.__h=[],e.some(function(o){o.call(a)})}catch(o){T.__e(o,a.__v)}})}function vt(e,t,n,l,a,o,c,u,d){var s,b,i,m=n.props,g=t.props,_=t.type,p=0;if(_==="svg"&&(a=!0),o!=null){for(;p<o.length;p++)if((s=o[p])&&"setAttribute"in s==!!_&&(_?s.localName===_:s.nodeType===3)){e=s,o[p]=null;break}}if(e==null){if(_===null)return document.createTextNode(g);e=a?document.createElementNS("http://www.w3.org/2000/svg",_):document.createElement(_,g.is&&g),o=null,u=!1}if(_===null)m===g||u&&e.data===g||(e.data=g);else{if(o=o&&ye.call(e.childNodes),b=(m=n.props||X).dangerouslySetInnerHTML,i=g.dangerouslySetInnerHTML,!u){if(o!=null)for(m={},p=0;p<e.attributes.length;p++)m[e.attributes[p].name]=e.attributes[p].value;(i||b)&&(i&&(b&&i.__html==b.__html||i.__html===e.innerHTML)||(e.innerHTML=i&&i.__html||""))}if(gt(e,g,m,a,u),i)t.__k=[];else if(Xe(e,Oe(p=t.props.children)?p:[p],t,n,l,a&&_!=="foreignObject",o,c,o?o[0]:n.__k&&_e(n,0),u,d),o!=null)for(p=o.length;p--;)o[p]!=null&&De(o[p]);u||("value"in g&&(p=g.value)!==void 0&&(p!==e.value||_==="progress"&&!p||_==="option"&&p!==m.value)&&fe(e,"value",p,m.value,!1),"checked"in g&&(p=g.checked)!==void 0&&p!==e.checked&&fe(e,"checked",p,m.checked,!1))}return e}function Ne(e,t,n){try{typeof e=="function"?e(t):e.current=t}catch(l){T.__e(l,n)}}function nt(e,t,n){var l,a;if(T.unmount&&T.unmount(e),(l=e.ref)&&(l.current&&l.current!==e.__e||Ne(l,null,t)),(l=e.__c)!=null){if(l.componentWillUnmount)try{l.componentWillUnmount()}catch(o){T.__e(o,t)}l.base=l.__P=null,e.__c=void 0}if(l=e.__k)for(a=0;a<l.length;a++)l[a]&&nt(l[a],t,n||typeof e.type!="function");n||e.__e==null||De(e.__e),e.__=e.__e=e.__d=void 0}function $t(e,t,n){return this.constructor(e,n)}function kt(e,t,n){var l,a,o,c;T.__&&T.__(e,t),a=(l=typeof n=="function")?null:n&&n.__k||t.__k,o=[],c=[],je(t,e=(!l&&n||t).__k=mt(V,null,[e]),a||X,X,t.ownerSVGElement!==void 0,!l&&n?[n]:a?null:t.firstChild?ye.call(t.childNodes):null,o,!l&&n?n:a?a.__e:t.firstChild,l,c),tt(o,e,c)}function rt(e,t){var n={__c:t="__cC"+ze++,__:e,Consumer:function(l,a){return l.children(a)},Provider:function(l){var a,o;return this.getChildContext||(a=[],(o={})[t]=this,this.getChildContext=function(){return o},this.shouldComponentUpdate=function(c){this.props.value!==c.value&&a.some(function(u){u.__e=!0,we(u)})},this.sub=function(c){a.push(c);var u=c.componentWillUnmount;c.componentWillUnmount=function(){a.splice(a.indexOf(c),1),u&&u.call(c)}}),l.children}};return n.Provider.__=n.Consumer.contextType=n}ye=Ye.slice,T={__e:function(e,t,n,l){for(var a,o,c;t=t.__;)if((a=t.__c)&&!a.__)try{if((o=a.constructor)&&o.getDerivedStateFromError!=null&&(a.setState(o.getDerivedStateFromError(e)),c=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(e,l||{}),c=a.__d),c)return a.__E=a}catch(u){e=u}throw e}},Je=0,ce.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=q({},this.state),typeof e=="function"&&(e=e(q({},n),this.props)),e&&q(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),we(this))},ce.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),we(this))},ce.prototype.render=V,z=[],qe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ke=function(e,t){return e.__v.__b-t.__v.__b},pe.__r=0,ze=0;var D,I,ve,Be,te=0,lt=[],ue=[],Fe=T.__b,Ge=T.__r,Ve=T.diffed,He=T.__c,Me=T.unmount;function ne(e,t){T.__h&&T.__h(I,e,te||t),te=0;var n=I.__H||(I.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:ue}),n.__[e]}function S(e){return te=1,wt(at,e)}function wt(e,t,n){var l=ne(D++,2);if(l.t=e,!l.__c&&(l.__=[n?n(t):at(void 0,t),function(u){var d=l.__N?l.__N[0]:l.__[0],s=l.t(d,u);d!==s&&(l.__N=[s,l.__[1]],l.__c.setState({}))}],l.__c=I,!I.u)){var a=function(u,d,s){if(!l.__c.__H)return!0;var b=l.__c.__H.__.filter(function(m){return m.__c});if(b.every(function(m){return!m.__N}))return!o||o.call(this,u,d,s);var i=!1;return b.forEach(function(m){if(m.__N){var g=m.__[0];m.__=m.__N,m.__N=void 0,g!==m.__[0]&&(i=!0)}}),!(!i&&l.__c.props===u)&&(!o||o.call(this,u,d,s))};I.u=!0;var o=I.shouldComponentUpdate,c=I.componentWillUpdate;I.componentWillUpdate=function(u,d,s){if(this.__e){var b=o;o=void 0,a(u,d,s),o=b}c&&c.call(this,u,d,s)},I.shouldComponentUpdate=a}return l.__N||l.__}function P(e,t){var n=ne(D++,3);!T.__s&&st(n.__H,t)&&(n.__=e,n.i=t,I.__H.__h.push(n))}function Y(e){return te=5,K(function(){return{current:e}},[])}function K(e,t){var n=ne(D++,7);return st(n.__H,t)?(n.__V=e(),n.i=t,n.__h=e,n.__V):n.__}function x(e,t){return te=8,K(function(){return e},t)}function ot(e){var t=I.context[e.__c],n=ne(D++,9);return n.c=e,t?(n.__==null&&(n.__=!0,t.sub(I)),t.props.value):e.__}function Z(){var e=ne(D++,11);if(!e.__){for(var t=I.__v;t!==null&&!t.__m&&t.__!==null;)t=t.__;var n=t.__m||(t.__m=[0,0]);e.__="P"+n[0]+"-"+n[1]++}return e.__}function xt(){for(var e;e=lt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(de),e.__H.__h.forEach(xe),e.__H.__h=[]}catch(t){e.__H.__h=[],T.__e(t,e.__v)}}T.__b=function(e){I=null,Fe&&Fe(e)},T.__r=function(e){Ge&&Ge(e),D=0;var t=(I=e.__c).__H;t&&(ve===I?(t.__h=[],I.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=ue,n.__N=n.i=void 0})):(t.__h.forEach(de),t.__h.forEach(xe),t.__h=[],D=0)),ve=I},T.diffed=function(e){Ve&&Ve(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(lt.push(t)!==1&&Be===T.requestAnimationFrame||((Be=T.requestAnimationFrame)||Tt)(xt)),t.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==ue&&(n.__=n.__V),n.i=void 0,n.__V=ue})),ve=I=null},T.__c=function(e,t){t.some(function(n){try{n.__h.forEach(de),n.__h=n.__h.filter(function(l){return!l.__||xe(l)})}catch(l){t.some(function(a){a.__h&&(a.__h=[])}),t=[],T.__e(l,n.__v)}}),He&&He(e,t)},T.unmount=function(e){Me&&Me(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(l){try{de(l)}catch(a){t=a}}),n.__H=void 0,t&&T.__e(t,n.__v))};var Re=typeof requestAnimationFrame=="function";function Tt(e){var t,n=function(){clearTimeout(l),Re&&cancelAnimationFrame(t),setTimeout(e)},l=setTimeout(n,100);Re&&(t=requestAnimationFrame(n))}function de(e){var t=I,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),I=t}function xe(e){var t=I;e.__c=e.__(),I=t}function st(e,t){return!e||e.length!==t.length||t.some(function(n,l){return n!==e[l]})}function at(e,t){return typeof t=="function"?t(e):t}var Ct=0;function r(e,t,n,l,a,o){var c,u,d={};for(u in t)u=="ref"?c=t[u]:d[u]=t[u];var s={type:e,props:d,key:n,ref:c,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--Ct,__source:a,__self:o};if(typeof e=="function"&&(c=e.defaultProps))for(u in c)d[u]===void 0&&(d[u]=c[u]);return T.vnode&&T.vnode(s),s}const ee=({title:e,children:t,show:n,scrollable:l,onClose:a,actions:o=[],size:c})=>{const u=Y(null),d=Y(null);return P(()=>{d.current=bootstrap.Modal.getOrCreateInstance(u.current,{backdrop:"static"})},[]),P(()=>{n?d.current.show():d.current.hide()},[n]),P(()=>{const s=u==null?void 0:u.current;if(!s)return;const b=()=>a==null?void 0:a();return s.addEventListener("hidden.bs.modal",b),()=>s.removeEventListener("hidden.bs.modal",b)},[a]),P(()=>()=>d.current.hide(),[]),r("div",{class:`modal fade ${c?`modal-${c}`:""}`,tabIndex:-1,ref:u,children:r("div",{class:`modal-dialog ${l?"modal-dialog-scrollable":""}`,children:r("div",{class:"modal-content",style:`${l?"":"max-height: 92vh;"}`,children:[r("div",{class:"modal-header",children:[r("h5",{class:"modal-title",children:e}),r("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),r("div",{class:"modal-body",children:t}),r("div",{class:"modal-footer",children:[a&&r("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"}),o.map(({label:s,type:b,onClick:i,disabled:m=!1,loading:g})=>r("button",{type:"button",class:`btn btn-${b}`,onClick:i,disabled:m,children:[g&&r("span",{class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),s]}))]})]})})})};function Q({text:e,children:t,placement:n="auto"}){const l=Z();return P(()=>{const a=document.getElementById(l);if(!a)return;const o=bootstrap.Tooltip.getOrCreateInstance(a,{placement:n});return()=>{o.dispose()}},[l,n]),e?r("div",{id:l,class:"preact-tooltip","data-bs-title":e,"data-bs-toggle":"tooltip",children:t}):r(V,{children:t})}const G={"_part.part_image":{render:e=>{if(!e.pk&&!e.id)return"";e.image||(e.image=e.pk||e.id);let t="";return e.image?t=/^(?:[a-z+]+:)?\/\//.test(e.image)?e.image:`/media/${e.image}`:t=blankImage(),renderModel({image:t,text:e.image||`Not found: ${e.id}`})},mapFunction:e=>({...e,id:e.image||e.id}),getSingle:(e,t)=>{inventreeGet("/api/part/thumbs/",{},{success:n=>{t(n.find(l=>l.image===e)||{image:"",id:e})}})}}};function M(e){const t=Z(),n=r(V,{children:[e.extraButtons,e.onDelete&&r("button",{class:"btn btn-outline-danger btn-sm",onClick:e.onDelete,children:r("i",{class:"fa fa-trash"})})]});return r("div",{class:"form-group row",children:[r("div",{class:"col-sm-2",children:r(Q,{text:e.tooltip,children:r("label",{for:`input-${t}`,class:"col-form-label col-form-label-sm",children:e.label})})}),(()=>{if(e.type==="text"||e.type==="number"||e.type==="email"||e.type==="float"){const{type:l,...a}=e;return r("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[r("input",{type:l==="float"?"number":l,class:"form-control form-control-sm",id:`input-${t}`,...l==="float"?{step:"any"}:{},...a}),n]})}else{if(e.type==="model")return r(Et,{extraFormGroup:n,id:t,...e});if(e.type==="checkbox"||e.type==="boolean"){const{type:l,value:a,...o}=e;return r("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[r("label",{class:"input-group-text",style:"flex: 1;",for:`input-${t}`,children:r("input",{type:"checkbox",class:"form-check-input form-check-sm",id:`input-${t}`,checked:a,...o,onInput:c=>{var u;return(u=o.onInput)==null?void 0:u.call(o,{currentTarget:{value:c.currentTarget.checked}})}})}),n]})}else{if(e.type==="textarea")return r("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[r("textarea",{class:"form-control form-control-sm",id:`input-${t}`,...e}),n]});if(e.type==="select")return r("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[r("select",{class:"form-select form-select-sm",id:`input-${t}`,...e,children:Object.entries(e.options).map(([l,a])=>r("option",{value:l,children:a}))}),n]});if(e.type==="array"){const{onDelete:l,onAdd:a}=e,o=c=>!e.onAdd&&e.value.length===c+1;return r("div",{class:"col-sm-10",children:r("div",{class:"d-flex flex-row flex-nowrap",style:"gap: 4px",children:[e.value.map((c,u)=>r("div",{class:"input-group",style:`max-width: 350px; ${o(u)?"margin-right: 31px;":""}`,children:[r("input",{type:"text",class:"form-control form-control-sm",id:`input-${t}-${u}`,value:c,onInput:d=>e.onInput(u)(()=>d.currentTarget.value)}),l&&r("button",{class:"btn btn-outline-danger btn-sm",onClick:l(u),children:r("i",{class:"fa fa-trash"})})]})),a&&r("button",{class:"btn btn-outline-primary btn-sm",onClick:()=>a(),children:"+"})]})})}}}return"Not implemented"})()]})}const Et=({model:e,extraFormGroup:t,id:n,onInput:l,value:a})=>(P(()=>($(`#${n}`).select2({placeholder:"",allowClear:!0,ajax:{url:e.api_url,dataType:"json",delay:250,cache:!0,data:o=>{var c;return{search:(c=o.term)==null?void 0:c.trim(),offset:o.page?(o.page-1)*25:0,limit:25,...e.limit_choices_to}},processResults:o=>{let c=[],u=!1;"count"in o&&"results"in o?(c=o.results,o.next&&(u=!0)):c=o;let d=c.map(s=>({id:s.pk,...s}));return G[e.model]&&(d=d.map(G[e.model].mapFunction)),{results:d,pagination:{more:u}}}},templateResult:o=>{var d;let c=o;if((d=o.element)!=null&&d.instance&&(c=o.element.instance),G[e.model])return $(G[e.model].render(c));if(!c.pk)return $("<span>Searching...</span>");const u=e.model.toLowerCase().split(".").at(-1);return $(`${renderModelData("",u,c,{})} <span>(${c.pk})</span>`)},templateSelection:o=>{var d;let c=o;if((d=o.element)!=null&&d.instance&&(c=o.element.instance),G[e.model])return $(G[e.model].render(c));if(!c.pk)return"";const u=e.model.toLowerCase().split(".").at(-1);return $(`${renderModelData("",u,c,{})} <span>(${c.pk})</span>`)}}),()=>{$(`#${n}`).select2("destroy")}),[n,e.api_url,e.limit_choices_to,e.model]),P(()=>($(`#${n}`).on("select2:select",o=>{l==null||l(o)}),$(`#${n}`).on("select2:clear",()=>{l==null||l({currentTarget:{value:""}})}),()=>{$(`#${n}`).off("select2:select"),$(`#${n}`).off("select2:clear")}),[n,l]),P(()=>{if(a&&a!==$(`#${n}`).val()){const o=`${e.api_url}/${a}/`.replace("//","/"),c=d=>{G[e.model]&&(d=G[e.model].mapFunction(d));const s=new Option("",d.id??d.pk,!0,!0);s.instance=d,$(`#${n}`).append(s).trigger("change"),$(`#${n}`).trigger({type:"select2:select",params:{data:d}})},u=G[e.model];if(u!=null&&u.getSingle)return u.getSingle(a,c);inventreeGet(o,{...e.limit_choices_to},{success:c})}},[n,e.api_url,e.limit_choices_to,e.model,a]),r("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[r("select",{class:"form-select form-select-sm",id:n}),t]})),it=rt({showNotification:()=>1}),re=()=>{const{showNotification:e}=ot(it);return{showNotification:e}},Ot=({children:e})=>{const[t,n]=S([]),l=Y([]);l.current=t.map((o,c)=>l.current[c]??yt());const a=x(o=>{const c=Math.random().toString(36).substring(2),u={id:c,autoHide:!0,...o};n(d=>[...d,u]),setTimeout(()=>{const d=l.current.length-1,s=l.current[d].current;bootstrap.Toast.getOrCreateInstance(s,{autohide:u.autoHide}).show(),s.addEventListener("hidden.bs.toast",()=>{n(i=>i.filter(m=>m.id!==c))})},0)},[]);return r(it.Provider,{value:{showNotification:a},children:r("div",{children:[e,r("div",{style:"position: fixed; bottom: 6px; right: 6px; display: flex; flex-direction: column; gap: 6px; z-index: 999999;",children:t.map(({id:o,type:c,message:u},d)=>r("div",{role:"alert","aria-live":"assertive","aria-atomic":"true",class:"toast",style:"border-radius: 5px;",ref:l.current[d],children:r("div",{class:`alert alert-${c}`,style:"margin-bottom: 0; padding: 8px; opacity: 0.8;",children:r("div",{style:{display:"flex",justifyContent:"space-between"},children:[r("div",{children:u}),r("button",{type:"button",class:"btn-close","data-bs-dismiss":"toast","aria-label":"Close",style:{fontSize:"10px"}})]})})},o))})]})})},Te=(e,t)=>{if(e===t)return!0;if(e===null&&t!==null||e!==null&&t===null||typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length!==t.length?!1:e.every((n,l)=>Te(e[l],t[l]));if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(typeof e=="object"){const n=Object.keys(e),l=Object.keys(t);return n.length!==l.length?!1:n.every(a=>Te(e[a],t[a]))}return!1},Ce=e=>{var n;const t={...e};return t.parent_name_match===""&&delete t.parent_name_match,t.extends===""&&delete t.extends,t.count=e.count.map(l=>l||null),t.childs=(n=e.childs)==null?void 0:n.map(Ce),t},he=e=>({...e,templates:e.templates.map(Ce),output:Ce(e.output)}),jt=e=>{const t=new Set,n=l=>{var a;for(const o of Object.keys(l.generate))t.add(o);(a=l.childs)==null||a.forEach(o=>n(o))};return n(e.output),e.templates.forEach(l=>n(l)),[...t]};function Nt(e=1){return()=>e++}const ct=(e,t,n=0,l="...")=>e.flatMap(([a,o])=>{const c=t(),u=`${l}/${a.name}`;return[{...a,id:c,pid:n,path:u},...ct(o,t,c,u)]}),$e=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),St=(e,t)=>{const n=document.createElement("a");n.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(t)}`),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},R=(e,t)=>fetch(e,{headers:{"Content-Type":"application/json",...t==null?void 0:t.headers},...t}),W={bulkcreate:({parentId:e,create:t,templateType:n}={})=>{const l=new URLSearchParams;e&&l.set("parent_id",e),t&&l.set("create",t?"true":"false"),n&&l.set("template_type",n);const a=l.toString();return`/plugin/inventree-bulk-plugin/bulkcreate${a?`?${a}`:""}`},templates:({id:e,templateType:t}={})=>{const n=new URLSearchParams;t&&n.set("template_type",t);const l=n.toString();return`/plugin/inventree-bulk-plugin/templates${e!=null?`/${e}`:""}${l?`?${l}`:""}`}},We=10,ut=({template:e,height:t,parentId:n,bulkGenerateInfo:l})=>{const{showNotification:a}=re(),o=Z(),c=K(()=>`preview-table-${o}`,[o]);return P(()=>{(async()=>{const u=await R(W.bulkcreate({parentId:n,create:!1}),{method:"POST",body:JSON.stringify({...e,template:JSON.stringify(he(e.template))})}),d=await u.json();if(!u.ok)return a({type:"danger",message:`An error occurred, ${d.error}`});const s=ct(d,Nt());a({type:"success",message:`Successfully parsed. This will generate ${s.length} items.`});const b=jt(e.template),i=$(`#${c}`),m={},g=(_,p,k)=>{if(p===void 0)return"";if(_.field_type==="model"){const v=h=>{const y=(()=>{var U;if(G[_.model.model]&&(h=G[_.model.model].mapFunction(h)),(U=h.element)!=null&&U.instance&&(h=h.element.instance),G[_.model.model])return G[_.model.model].render(h);const j=N=>{if(!N.pk)return"";const F=_.model.model.toLowerCase().split(".").at(-1);return`${renderModelData("",F,N,{})} <span>(${N.pk})</span>`},E=h.count;if(_.allow_multiple&&h.results&&(h=h.results),_.allow_multiple&&Array.isArray(h)){let N=!1,F="";return E===void 0?(N=E>h.length,F=`${E-h.length} more elements`):h.length>=We&&(h.pop(),N=!0,F="at least one more element"),`${`<li>${h.map(j).join("</li><li>")}</li>`}${N?`<li>... ${F}</li>`:""}`}return j(h)})(),w=document.getElementById(k);w&&(w.innerHTML=y,w.classList.remove("placeholder","placeholder-glow","col-4"),i.bootstrapTable("resetView"))},f=G[_.model.model];if(f!=null&&f.getSingle){const h=`~get-single-${p}`;m[h]||(m[h]=[],f.getSingle(p,y=>m[h].forEach(w=>w(y)))),m[h].push(v)}else{let h=`${p}/`,y={..._.model.limit_choices_to};Number.isNaN(parseInt(p,10))&&(h="",y={...JSON.parse(p),...y},"name"in y&&(y.search=y.name));const w=`${_.model.api_url}/${h}?limit=${We}`.replace("//","/"),j=`~get-api-${w}-${JSON.stringify(p)}`;m[j]||(m[j]=[],inventreeGet(w,{...y},{success:E=>{m[j].forEach(U=>U(E))}})),m[j].push(v)}return`<span id=${k} class="placeholder placeholder-glow col-4">${p}</span>`}return _.field_type==="select"?$e(_.options[p]??`${p}`):_.field_type==="list"&&Array.isArray(p)?`<ul>${p.map((v,f)=>`<li>${g(_.items_type,v,`${k}-${f}`)}</li>`).join("")}</ul>`:_.field_type==="object"&&typeof p=="object"?`<ul>${Object.entries(p).map(([v,f],h)=>`<li>${$e(_.fields[v].name??v)}: ${g(_.fields[v],f,`${k}-${h}`)}</li>`).join("")}</ul>`:$e(`${p}`)};i.bootstrapTable("destroy"),i.bootstrapTable({data:s,idField:"id",height:t,columns:[...Object.entries(l.fields).filter(([_])=>b.includes(_)).map(([_,p])=>({field:_,title:p.name,formatter:(k,v,f,h)=>g(p,k,`table-${o}-field-${f}-${h}`)})),{field:"path",title:"Path"}],treeShowField:"name",parentIdField:"pid",onPostBody(){const _=i.bootstrapTable("getOptions").columns;_&&_[0][1].visible&&i.treegrid({treeColumn:0,onChange(){i.bootstrapTable("resetView")}})},rowStyle:()=>({css:{padding:"2px 0.5rem"}})})})()},[l.fields,t,o,n,a,c,e]),r("div",{class:"mt-3",children:r("table",{id:c,style:{whiteSpace:"nowrap"}})})},Ke=(e,t)=>({...e,template:{...e.template,input:Object.fromEntries(t.map(({key:n,value:l})=>[n,l]))}}),It=({template:e,parentId:t,attachPreviewHandler:n,attachCreateHandler:l,handleDoneCreate:a,setIsBulkCreateLoading:o})=>{const[c,u]=S(),[d,s]=S([]),[b,i]=S(!0),[m,g]=S(),{showNotification:_}=re();P(()=>{!(e!=null&&e.template_type)||!t||(async()=>{const h=await R(W.bulkcreate({parentId:t,templateType:e.template_type}));if(!h.ok)return _({type:"danger",message:`Failed to load bulk generate info,
${h.statusText}`});const y=await h.json();g(y)})()},[t,_,e==null?void 0:e.template_type]),P(()=>{s(Object.entries(e.template.input).map(([h,y])=>({key:h,value:y})))},[e.template.input]);const p=x(h=>y=>{s(w=>w.map(({key:j,value:E})=>({key:j,value:h===j?y.currentTarget.value:E})))},[]),k=x(async()=>{o(!0);const h=Ke(e,d),y=await R(W.bulkcreate({parentId:t,create:!0}),{method:"POST",body:JSON.stringify({...h,template:JSON.stringify(he(h.template))})}),w=await y.json();if(o(!1),!y.ok)return a==null||a(!1),_({type:"danger",message:`An error occurred, ${w.error}`});_({type:"success",message:`Successfully bulk created ${w.length} ${m==null?void 0:m.name}s.`}),a==null||a(!0)},[m==null?void 0:m.name,a,d,t,o,_,e]),v=x(()=>{const h=structuredClone(Ke(e,d));u(h),i(!1)},[d,e]),f=x(()=>{k()},[k]);return P(()=>n==null?void 0:n(v),[n,v]),P(()=>l==null?void 0:l(f),[l,f]),r("div",{children:[r("h5",{children:"Inputs"}),r("div",{children:d.map(({key:h,value:y})=>r(M,{type:"text",label:h,value:y,onInput:p(h)},h))}),c&&m&&r(V,{children:[r("h5",{children:"Preview"}),r("div",{class:b?"mb-4":"",children:r(ut,{template:c,height:350,parentId:t,bulkGenerateInfo:m})})]})]})},me=e=>e.default?e.default:e.field_type==="list"?[me(e.items_type)]:e.field_type==="object"?Object.fromEntries(Object.entries(e.fields).filter(([,t])=>t.required).map(([t,n])=>[t,me(n)])):e.field_type==="boolean"?!1:e.field_type==="float"||e.field_type==="number"?"0":"",dt=({fieldDefinition:e,field:t,setField:n,onDelete:l})=>e.field_type==="object"?r(_t,{fieldsDefinition:e,fields:t,setFields:n,onDelete:l}):e.field_type==="list"?r(At,{fieldsDefinition:e,fields:t,setFields:n,onDelete:l}):r(Ut,{fieldDefinition:e,field:t,setField:n,onDelete:l}),At=({fieldsDefinition:e,fields:t,setFields:n,onDelete:l})=>{const a=e.items_type,o=x(d=>s=>{n(b=>{const i=[...b];return i[d]=typeof s=="function"?s(i[d]):s,i})},[n]),c=x(()=>{const d=me(a);n(s=>[...s,d])},[a,n]),u=x(d=>()=>{n(s=>s.filter((b,i)=>d!==i))},[n]);return r("div",{class:"mb-1 card",children:r("div",{class:"d-flex justify-content-between",children:[r("div",{className:"col p-2",children:[e.name&&r(Q,{text:e.description||"",children:r("h6",{children:e.name})}),r("div",{class:"ms-3",children:[t.map((d,s)=>r(dt,{fieldDefinition:a,field:d,setField:o(s),onDelete:u(s)})),r("div",{style:{display:"flex",justifyContent:"space-between"},children:r("button",{class:"btn btn-sm btn-outline-primary",onClick:c,children:["Add ",e.name]})})]})]}),l&&r("div",{class:"p-1",children:r("button",{onClick:l,class:"btn btn-sm btn-outline-danger",children:r("i",{class:"fa fa-trash"})})})]})})},_t=({fieldsDefinition:e,fields:t,setFields:n,onDelete:l,showCard:a=!0})=>{const o=e.fields,c=x(m=>g=>n(_=>({..._,[m]:typeof g=="function"?g(_[m]):g})),[n]),u=K(()=>{const m=Object.keys(t);return Object.entries(o).filter(([g])=>!m.includes(g))},[t,o]),[d,s]=S(""),b=x(m=>{if(m!==""){const g=o[m],_=me(g);c(m)(_),s("")}},[o,c]),i=x(m=>()=>{n(g=>{const _={...g};return delete _[m],_})},[n]);return r("div",{class:`${a?"card mb-1":""}`,children:r("div",{class:"d-flex justify-content-between",children:[r("div",{class:`col ${a?"p-2":""}`,children:[e.name&&r(Q,{text:e.description||"",children:r("h6",{children:e.name})}),Object.entries(o).filter(([m])=>t[m]!==void 0).map(([m,g])=>{const _=t[m];return r(dt,{fieldDefinition:g,field:_,setField:c(m),onDelete:g.required?void 0:i(m)},m)}),u.length>0&&r("div",{style:"display: flex; max-width: 200px;",children:r("select",{class:"form-select form-select-sm",value:d,onInput:m=>b(m.currentTarget.value),children:[r("option",{selected:!0,value:"",children:"Add key"}),u.map(([m,{name:g}])=>r("option",{value:m,children:g}))]})})]}),l&&r("div",{class:"p-1",children:r("button",{onClick:l,class:"btn btn-sm btn-outline-danger",children:r("i",{class:"fa fa-trash"})})})]})})},Pt=e=>e.field_type==="boolean"?"Use a template that evaluates to something boolean like (e.g. 'true' or 'false').":e.field_type==="number"?"Use a template that evaluates to something number like (e.g. '10').":e.field_type==="float"?"Use a template that evaluates to something float like (e.g. '3.1415').":e.field_type==="model"?`Use a template that evaluates to a valid id for this model (e.g. '42') or a json string containing django model filters (e.g. {"name": "R_10k_0808_10%"} or {"name__startswith": "R_"}), but be aware that the preview table may not work correctly due to API limitations. Bulk create will work correctly then. ${e.allow_multiple?"The filters can also return multiple objects.":"The filters must return only one object."}`:e.field_type==="select"?`Use a template that evaluates to a valid option from the select field. Available options: ${Object.keys(e.options).join(", ")}`:"",Lt=(e,t)=>{const n=`${t}`;return e.field_type==="number"?!/^\d*$/.test(n):e.field_type==="float"?!/^[\d\\.,]*$/.test(n):e.field_type==="boolean"?!["true","false",""].includes(n):n.includes("{")||n.includes("}")},Ut=({fieldDefinition:e,field:t,setField:n,onDelete:l})=>{const[a,o]=S(()=>Lt(e,t)),c=K(()=>e.field_type!=="text",[e.field_type]),u=Z(),d=K(()=>a?"text":e.field_type,[e.field_type,a]);return r(V,{children:r(M,{label:e.name,tooltip:e.description||void 0,type:d,...e.field_type==="model"?{model:e.model}:{},...e.field_type==="select"?{options:e.options}:{},value:t,onInput:s=>n(s.currentTarget.value),onDelete:l,extraButtons:c&&r(V,{children:[r("input",{type:"checkbox",class:"btn-check",id:`btn-check-${u}`,checked:a,onInput:()=>o(s=>!s),autoComplete:"off"}),r("label",{class:"btn btn-sm btn-outline-primary",for:`btn-check-${u}`,style:"display: flex; align-items: center;",children:r(Q,{text:Pt(e),children:r("i",{class:"fas fa-code"})})})]})})})},Bt="1.1.0",Se={version:Bt,input:{},templates:[],output:{parent_name_match:"true",dimensions:[""],count:[""],generate:{}}};function Ee({childSchema:e,setChildSchema:t,bulkGenerateInfo:n,extendsKeys:l}){var v;P(()=>{Object.keys(e.generate).length===0&&Object.keys(n.fields).length>0&&t(f=>({...f,generate:Object.fromEntries(Object.entries(n.fields).filter(([,{required:h}])=>!!h).map(([h])=>[h,""]))}))},[n.fields,e,t]);const a=x(f=>h=>t(y=>({...y,[f]:h.currentTarget.value})),[t]),o=x(f=>t(h=>({...h,generate:typeof f=="function"?f(h.generate):f})),[t]),c=x(f=>h=>y=>t(w=>(w[f][h]=typeof y=="function"?y(w[f][h]):y,{...w,[f]:w[f]})),[t]),u=x(()=>t(f=>(f.dimensions.push(""),f.count.push(""),{...f,dimensions:f.dimensions,count:f.count})),[t]),d=x(f=>()=>t(h=>({...h,dimensions:h.dimensions.filter((y,w)=>w!==f),count:h.count.filter((y,w)=>w!==f)})),[t]),s=x(f=>h=>t(y=>(y.childs||(y.childs=[]),y.childs[f]=typeof h=="function"?h(y.childs[f]):h,{...y,childs:y.childs})),[t]),b=x(()=>t(f=>(f.childs||(f.childs=[]),f.childs.push(structuredClone(Se.output)),{...f,childs:f.childs})),[t]),i=x(f=>()=>t(h=>h.childs?{...h,childs:h.childs.filter((y,w)=>w!==f)}:h),[t]),g=`bulk-child-schema-editor-${Z()}`,[_,p]=S(!1),k=x(()=>{p(f=>($(`#${g}`).collapse(f?"hide":"show"),!f))},[g]);return r("div",{class:"",children:[r(M,{label:"Dimensions",tooltip:"A childs naming convention could have multiple dimensions where it is counting in",type:"array",onDelete:d,value:e.dimensions.map(f=>f||""),onInput:c("dimensions"),onAdd:u}),r(M,{label:"Count",tooltip:"Limit the amount of generated items for the individual dimension",type:"array",value:e.count.map(f=>f||""),onInput:c("count")}),r("h6",{class:`user-select-none collapsable-heading ${_?"active":""}`,role:"button",onClick:k,children:"Advanced"}),r("div",{class:"collapse",id:g,children:[n.generate_type==="tree"&&r(V,{children:[r(M,{label:"Parent name match",tooltip:"First child that matches the parent name matcher will be chosen for generating the childs for a specific parent. Must evaluate to something that can be casted to a boolean.",type:"text",value:e.parent_name_match||"",onInput:a("parent_name_match")}),l&&r(M,{label:"Extends",tooltip:"Choose to extend from a template",type:"select",options:l,value:e.extends||"",onInput:a("extends")})]}),r(M,{label:"Global context",tooltip:"This template gets imported under the 'global' namespace to all generate fields. Use this to setup variables via the set keyword ('{% set hello = 'world' %}')which can be accessed as 'global.<x>' ('{{ global.hello }}').",type:"textarea",value:e.global_context||"",onInput:a("global_context")})]}),r("div",{class:"mt-3",children:r(Q,{text:"You can use {{dim.x}} as a placeholder for the generated output of the dimension. For more info see the Readme.",children:r("h5",{children:"Generate"})})}),r(_t,{fieldsDefinition:{name:"",description:null,required:!0,field_type:"object",fields:n.fields},fields:e.generate,setFields:o,showCard:!1}),n.generate_type==="tree"&&r(V,{children:[r("h5",{class:"mt-3",children:"Childs"}),r("div",{class:"ms-3",children:(v=e.childs)==null?void 0:v.map((f,h)=>r("div",{class:"card mb-2",children:r("div",{class:"d-flex justify-content-between",children:[r("div",{class:"col p-3",children:r(Ee,{childSchema:f,setChildSchema:s(h),bulkGenerateInfo:n,extendsKeys:l})}),r("div",{class:"p-1",children:r("button",{onClick:i(h),class:"btn btn-sm btn-outline-danger",children:r("i",{class:"fa fa-trash"})})})]})}))}),r("button",{onClick:b,class:"btn btn-outline-primary btn-sm",children:"Add child"})]})]})}function Ft({schema:e,setSchema:t,bulkGenerateInfo:n}){const l=Y(!0),a=x(p=>t(k=>({...k,output:typeof p=="function"?p(k.output):p})),[t]),[o,c]=S([]),u=x((p,k)=>v=>c(f=>(f[p][k]=v.currentTarget.value,[...f])),[c]),d=x(()=>c(p=>[...p,{key:"",value:""}]),[c]),s=x(p=>()=>c(k=>k.filter((v,f)=>f!==p)),[c]);P(()=>{o.length>0&&t(p=>({...p,input:Object.fromEntries(o.map(({key:k,value:v})=>[k,v]))}))},[o,t]),P(()=>{l.current&&(e!=null&&e.input)&&Object.keys(e.input).length!==0&&(c(Object.entries(e.input).map(([p,k])=>({key:p,value:k}))),l.current=!1)},[e==null?void 0:e.input,o,c]);const b=x(p=>k=>t(v=>(v.templates[p]=typeof k=="function"?k(v.templates[p]):k,{...v,templates:v.templates})),[t]),i=x(()=>t(p=>(p.templates.push({name:"",...structuredClone(Se.output)}),{...p,templates:p.templates})),[t]),m=x(p=>()=>t(k=>({...k,templates:k.templates.filter((v,f)=>f!==p)})),[t]),g=K(()=>({"":"---",...e?Object.fromEntries(e.templates.filter(p=>p&&p.name).map(p=>[p.name,p.name])):{}}),[e]),_=Z();return r("div",{children:[r("div",{class:"card",children:[r("div",{class:"card-header",children:r("h5",{class:"mb-0 user-select-none",role:"button","data-bs-toggle":"collapse","data-bs-target":`#accordion-${_}-input`,children:"Input"})}),r("div",{id:`accordion-${_}-input`,class:"collapse",children:r("div",{class:"card-body",children:[o.map((p,k)=>r("div",{class:"input-group input-group-sm mb-2",children:[r("span",{class:"input-group-text",children:"Key"}),r("input",{type:"text",value:p.key,onInput:u(k,"key")}),r("span",{class:"input-group-text",children:"Value"}),r("input",{type:"text",style:"flex: 1;",value:p.value,onInput:u(k,"value")}),r("button",{class:"btn btn-outline-danger btn-sm",onClick:s(k),children:r("i",{class:"fa fa-trash"})})]})),r("button",{onClick:d,class:"btn btn-outline-primary btn-sm",children:"Add input"})]})})]}),n.generate_type==="tree"&&r(V,{children:r("div",{class:"card mt-2",children:[r("div",{class:"card-header",children:r("h5",{class:"mb-0 user-select-none",role:"button","data-bs-toggle":"collapse","data-bs-target":`#accordion-${_}-templates`,children:"Templates"})}),r("div",{id:`accordion-${_}-templates`,class:"collapse",children:r("div",{class:"card-body",children:[e.templates.map((p,k)=>r("div",{class:"card mb-2",children:r("div",{class:"d-flex justify-content-between",children:[r("div",{class:"col p-3",children:[p!==null&&r(M,{label:"Template name",type:"text",value:p.name,onInput:v=>b(k)(f=>({...f,name:v.currentTarget.value}))}),r(Ee,{childSchema:p,setChildSchema:b(k),bulkGenerateInfo:n,extendsKeys:g})]}),r("div",{class:"p-1",children:r("button",{onClick:m(k),class:"btn btn-sm btn-outline-danger",children:r("i",{class:"fa fa-trash"})})})]})})),r("button",{onClick:i,class:"btn btn-outline-primary btn-sm",children:"Add template"})]})})]})}),r("div",{class:"card mt-2",children:[r("div",{class:"card-header",children:r("h5",{class:"mb-0 user-select-none",role:"button","data-bs-toggle":"collapse","data-bs-target":`#accordion-${_}-output`,children:"Output"})}),r("div",{id:`accordion-${_}-output`,class:"collapse show",children:r("div",{class:"card-body",children:r(Ee,{childSchema:e.output,setChildSchema:a,bulkGenerateInfo:n,extendsKeys:g})})})]})]})}const pt=rt({bulkGenerateInfoDict:{},reload:async()=>{}}),Gt=()=>{const{bulkGenerateInfoDict:e,reload:t}=ot(pt);return{bulkGenerateInfoDict:e,reload:t}},Vt=({children:e})=>{const[t,n]=S({}),{showNotification:l}=re(),a=x(async()=>{const o=await R(W.bulkcreate());if(!o.ok)return l({type:"danger",message:`Could not load bulk generate info, ${o.statusText}`});const c=Object.fromEntries((await o.json()).map(u=>[u.template_type,u]));n(c)},[l]);return P(()=>{a()},[a]),r(pt.Provider,{value:{bulkGenerateInfoDict:t,reload:a},children:e})},Ht=({templateId:e,handleBack:t,templateType:n,parentId:l,initialTemplate:a})=>{var Ie;const[o,c]=S(null),[u,d]=S(null),[s,b]=S(null),i=K(()=>!Te(s,o),[s,o]),m=x(O=>L=>b(H=>H?{...H,[O]:L.currentTarget.value}:null),[]),g=x(O=>{b(L=>L===null?L:{...L,template:typeof O=="function"?O(L.template):O})},[]),[_,p]=S(!0),[k,v]=S(!0),[f,h]=S(),{showNotification:y}=re(),{bulkGenerateInfoDict:w}=Gt(),j=K(()=>Object.fromEntries(Object.values(w).map(O=>[O.template_type,O.name])),[w]);P(()=>{!(s!=null&&s.template_type)||!l||(v(!0),(async()=>{const O=await R(W.bulkcreate({parentId:l,templateType:s.template_type}));if(!O.ok)return v(!1),y({type:"danger",message:`Failed to load bulk generate info,
${O.statusText}`});const L=await O.json();h(L),v(!1)})())},[l,y,s==null?void 0:s.template_type]);const E=K(()=>!e&&!(s!=null&&s.id),[s==null?void 0:s.id,e]),U=x(async()=>{p(!0);let O=null;if(a)O=structuredClone(a);else if(e){const L=await R(W.templates({id:e}));if(!L.ok)return p(!1),y({type:"danger",message:`Fetching template failed,
${L.statusText}`});const H=await L.json();O={...H,template:JSON.parse(H.template)}}else O={id:null,name:"",template:structuredClone(Se),template_type:n||"STOCK_LOCATION"};c(structuredClone(O)),b(structuredClone(O)),p(!1)},[a,y,e,n]);P(()=>{U()},[U]);const N=x(async()=>{if(!s)return!1;const O=await R(W.templates({id:E?null:s.id}),{method:E?"POST":"PUT",body:JSON.stringify({...s,template:JSON.stringify(he(s.template))})}),L=await O.json();return O.ok?(E?(s.id=L.id,b({...s}),y({type:"success",message:"Template successfully created."})):y({type:"success",message:"Template successfully updated."}),c(structuredClone(s)),!0):(y({type:"danger",message:`An error occurred. ${Object.entries(L).map(([H,ft])=>`${H}: ${ft.join(", ")}`).join(", ")}`,autoHide:!1}),!1)},[E,y,s]),F=x(()=>b(structuredClone(o)),[o]),C=x(()=>{d(structuredClone(s))},[s]),[A,B]=S(!1),[J,le]=S(!1),oe=x(async()=>{var H;if(s===null)return;le(!0);const O=await R(W.bulkcreate({parentId:l,create:!0}),{method:"POST",body:JSON.stringify({...s,template:JSON.stringify(he(s.template))})}),L=await O.json();if(le(!1),B(!1),!O.ok)return y({type:"danger",message:`An error occurred, ${L.error}`});y({type:"success",message:`Successfully bulk created ${L.length} ${(H=w[s.template_type])==null?void 0:H.name}s.`})},[w,l,y,s]),se=x(()=>{const O=`${Date.now()}_${s==null?void 0:s.name}.json`;St(O,JSON.stringify({name:s==null?void 0:s.name,template_type:s==null?void 0:s.template_type,template:s==null?void 0:s.template})),y({type:"success",message:`Successfully downloaded template '${s==null?void 0:s.name}' as '${O}'.`})},[y,s==null?void 0:s.name,s==null?void 0:s.template,s==null?void 0:s.template_type]),ae=x(()=>{navigator.clipboard.writeText(JSON.stringify({name:s==null?void 0:s.name,template_type:s==null?void 0:s.template_type,template:s==null?void 0:s.template})).then(()=>y({type:"success",message:`Successfully copied template '${s==null?void 0:s.name}' to clipboard.`})).catch(O=>y({type:"danger",message:`Error copying template '${s==null?void 0:s.name}' to clipboard. ${O}`}))},[y,s==null?void 0:s.name,s==null?void 0:s.template,s==null?void 0:s.template_type]),[be,ge]=S(!1);return r("div",{children:[r("h5",{children:[E?"Create":"Edit"," ",E?"":`"${s==null?void 0:s.name}" `,"template"]}),_&&r("div",{class:"d-flex justify-content-center",children:r("div",{class:"spinner-border",role:"status",children:r("span",{class:"visually-hidden",children:"Loading..."})})}),!_&&!k&&f&&s&&r("div",{children:[r(M,{label:"Name",type:"text",value:s.name,onInput:m("name")}),!n&&r(M,{label:"Template type",type:"select",value:s.template_type,options:j,onInput:m("template_type")}),r(Ft,{schema:s.template,setSchema:g,bulkGenerateInfo:f})]}),r("div",{class:"d-flex mt-2",style:"gap: 5px",children:[r("button",{class:"btn btn-outline-primary",onClick:()=>i?ge(!0):t(),children:"Back"}),r("button",{class:`btn ${i?"btn-outline-success":"btn-outline-secondary"}`,onClick:N,disabled:!i,children:E?"Create":"Update"}),!E&&r("button",{class:`btn ${i?"btn-outline-danger":"btn-outline-secondary"}`,onClick:F,disabled:!i,children:"Reset"}),r("button",{class:"btn btn-outline-primary",onClick:C,children:"Preview"}),l&&r("button",{class:"btn btn-outline-primary",onClick:()=>B(!0),children:"Bulk create"}),r("div",{class:"btn-group btn-group-sm",children:[r("button",{class:"btn btn-outline-primary px-3",onClick:ae,children:r(Q,{text:"Copy to clipboard",placement:"top",children:r("i",{class:"fas fa-clipboard"})})}),r("button",{class:"btn btn-outline-primary px-3",onClick:se,alt:"Download as file",children:r(Q,{text:"Download as file",placement:"top",children:r("i",{class:"fas fa-download"})})})]})]}),u&&f&&r(ut,{template:u,parentId:l,bulkGenerateInfo:f}),r(ee,{title:"Bulk create",show:A,onClose:()=>{B(!1)},actions:[{label:"Bulk create",type:"primary",onClick:oe,disabled:J,loading:J}],children:["Are you sure you want to bulk generate"," ",((Ie=w[(s==null?void 0:s.template_type)||""])==null?void 0:Ie.name)||(s==null?void 0:s.template_type),"s here?"]}),r(ee,{title:"Save the template",show:be,onClose:()=>ge(!1),actions:[{label:"Don't save",type:"outline-danger",onClick:t},{label:"Save",type:"primary",onClick:()=>{N().then(O=>{ge(!1),O===!0&&t()})}}],children:"Do you want to save the template?"})]})},Mt=({templateType:e,parentId:t})=>{const[n,l]=S([]),[a,o]=S(!0),[c,u]=S(null),[d,s]=S("OVERVIEW"),{showNotification:b}=re(),i=x(async()=>{o(!0);const C=await R(W.templates({templateType:e}));if(!C.ok)return o(!1),b({type:"danger",message:`Fetching templates failed,
${C.statusText}`});const A=await C.json();l(A.map(B=>({...B,template:JSON.parse(B.template)}))),o(!1)},[b,e]);P(()=>{i()},[i]);const m=x((C,A)=>()=>{s(C),u(A)},[]),g=x(()=>{u(null),s("OVERVIEW"),i()},[i]),_=x(async()=>{if(c===null)return;const C=await R(W.templates({id:c.id}),{method:"DELETE"});if(!C.ok)return b({type:"danger",message:`Deleting template failed,
${C.statusText}`});u(null),s("OVERVIEW"),l(A=>[...A.filter(B=>B.id!==c.id)]),b({type:"success",message:"Template successfully deleted."})},[c,b]),p=Y(()=>{}),k=Y(()=>{}),v=x(()=>{w(!1),u(null),s("OVERVIEW")},[]),[f,h]=S(!1),[y,w]=S(!1),j=x(C=>{const A=JSON.parse(C);if(!("template_type"in A)||!("name"in A)||!("template"in A))throw new Error("invalid format");if(e&&e!==A.template_type)throw new Error(`Template type ${A.template_type} cannot be imported as a ${e} template.`);m("EDITING",{id:null,...A})()},[m,e]),E=Y(null),[U,N]=S(!1),F=x(()=>{var C,A;try{const B=(A=(C=E.current)==null?void 0:C.files)==null?void 0:A[0],J=new FileReader;J.onload=le=>{var oe,se,ae;try{j(((se=(oe=le.target)==null?void 0:oe.result)==null?void 0:se.toString())||""),(ae=E.current)!=null&&ae.value&&(E.current.value="")}catch(be){b({type:"danger",message:`Cannot import from file. ${be}`})}},J.readAsText(B,"UTF-8")}catch(B){b({type:"danger",message:`Cannot import from file. ${B}`})}},[j,b]);return d==="EDITING"?r("div",{children:r(Ht,{handleBack:g,templateId:c==null?void 0:c.id,templateType:e,parentId:t,initialTemplate:(c==null?void 0:c.id)===null?c:void 0})}):r("div",{children:[r("table",{class:"table table-bordered",style:"max-width: 500px",children:[r("thead",{children:r("tr",{children:[r("th",{children:"Name"}),r("th",{children:"Actions"})]})}),r("tbody",{children:a?r("tr",{children:r("td",{colSpan:2,children:r("div",{class:"d-flex justify-content-center",children:r("div",{class:"spinner-border",role:"status",children:r("span",{class:"visually-hidden",children:"Loading..."})})})})}):n.map(C=>r("tr",{children:[r("td",{children:C.name}),r("td",{children:[r("button",{class:"btn btn-sm btn-outline-danger me-1",onClick:m("DELETING",C),children:"Delete"}),r("button",{class:"btn btn-sm btn-outline-success me-1",onClick:m("EDITING",C),children:"Edit"}),r("button",{class:"btn btn-sm btn-outline-primary",onClick:m("PREVIEWING",C),children:"Preview/Bulk create"})]})]}))})]}),r("div",{class:"btn-group",children:[r("button",{type:"button",class:"btn btn-outline-primary",onClick:m("EDITING",null),children:"New untitled schema"}),r("button",{class:"btn btn-outline-primary dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false"}),r("ul",{class:"dropdown-menu",children:[r("li",{children:r("button",{class:"dropdown-item",onClick:()=>navigator.clipboard.readText().then(C=>j(C)).catch(C=>b({type:"danger",message:`Error importing from clipboard, ${C}`})),children:"From clipboard"})}),r("li",{children:r("button",{class:"dropdown-item",onClick:()=>m("IMPORT_TEMPLATE",null)(),children:"From file"})})]})]}),r(ee,{title:"Delete template",show:d==="DELETING",onClose:()=>{u(null),s("OVERVIEW")},actions:[{label:"Delete",type:"danger",onClick:_}],children:['Are you sure you want to delete the template "',c==null?void 0:c.name,'"?']}),r(ee,{title:"Preview/bulk create from template",show:d==="PREVIEWING",onClose:v,actions:[{label:"Preview",type:"primary",onClick:()=>{p.current(),w(!0)}},{label:"Bulk create",type:"outline-primary",onClick:()=>k.current(),disabled:f||!y,loading:f}],children:c&&r(V,{children:[r(It,{template:c,parentId:t,attachPreviewHandler:C=>{p.current=C},attachCreateHandler:C=>{k.current=C},handleDoneCreate:C=>{C&&v()},setIsBulkCreateLoading:h}),!y&&r("i",{children:"You need to preview the items first."})]})}),r(ee,{title:"Import template",show:d==="IMPORT_TEMPLATE",onClose:()=>{var C;u(null),s("OVERVIEW"),(C=E.current)!=null&&C.value&&(E.current.value="")},actions:[{label:"Import",type:"outline-primary",onClick:F,disabled:!U}],children:r("input",{type:"file",onInput:C=>{var A,B,J;return N(!((J=(B=(A=C.current)==null?void 0:A.target)==null?void 0:B.files)!=null&&J[0]))},ref:E})})]})},Rt=({children:e})=>r(Ot,{children:r(Vt,{children:e})});function Wt({target:e,objectId:t,objectType:n}){kt(r(Rt,{children:r(Mt,{templateType:n,parentId:t})}),e)}export{Wt as render};
