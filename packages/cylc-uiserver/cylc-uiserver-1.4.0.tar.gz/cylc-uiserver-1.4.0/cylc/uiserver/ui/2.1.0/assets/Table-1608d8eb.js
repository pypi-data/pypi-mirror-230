import{bz as I,da as V,cx as R,dD as B,dE as E,dF as $,dG as p,dH as A,aM as c,aN as z,az as u,o as v,bs as l,z as n,bD as J,p as M,bE as D,bC as F,r as o,bu as y,a_ as r,b_ as q,al as L,c4 as U,q as g,aK as G,F as K,ce as W,c7 as H,ch as Q,ci as X,cf as Y,dI as Z}from"./index-8c9d4a8a.js";import{g as j}from"./graphql-ef51ac83.js";function w(e,t){return e=(e??"")===""?1/0:new Date(e).getTime(),t=(t??"")===""?1/0:new Date(t).getTime(),e===t?0:e-t}const ee={name:"TableComponent",props:{tasks:{type:Array,required:!0},filterable:{type:Boolean,default:!0}},components:{Task:V,Job:R,TaskFilter:B},data(){return{itemsPerPage:50,sortBy:[{key:"task.tokens.cycle",order:JSON.parse(localStorage.cyclePointsOrderDesc??!0)?"desc":"asc"}],tasksFilter:{}}},computed:{filteredTasks(){return this.tasks.filter(({task:e})=>E(e,this.tasksFilter.id,this.tasksFilter.states))}},methods:{dtMean:$},headers:[{title:"Task",key:"task.name",sortable:!0,sort:p},{title:"Jobs",key:"data-table-expand",sortable:!1},{title:"Cycle Point",key:"task.tokens.cycle",sortable:!0,sort:(e,t)=>p(String(e??""),String(t??""))},{title:"Platform",key:"latestJob.node.platform",sortable:!0,sort:(e,t)=>p(e??"",t??"")},{title:"Job Runner",key:"latestJob.node.jobRunnerName",sortable:!0,sort:(e,t)=>p(e??"",t??"")},{title:"Job ID",key:"latestJob.node.jobId",sortable:!0,sort:(e,t)=>p(e??"",t??"")},{title:"Submit",key:"latestJob.node.submittedTime",sortable:!0,sort:(e,t)=>w(e??"",t??"")},{title:"Start",key:"latestJob.node.startedTime",sortable:!0,sort:(e,t)=>w(e??"",t??"")},{title:"Finish",key:"latestJob.node.finishedTime",sortable:!0,sort:(e,t)=>w(e??"",t??"")},{title:"Run Time",key:"task.node.task.meanElapsedTime",sortable:!0,sort:(e,t)=>parseInt(e??0)-parseInt(t??0)}],icons:{mdiChevronDown:A},itemsPerPageOptions:[{value:10,title:"10"},{value:20,title:"20"},{value:50,title:"50"},{value:100,title:"100"},{value:200,title:"200"},{value:-1,title:"All"}]},te={class:"d-flex align-content-center flex-nowrap"},se={class:"mr-1"},ae={class:"mr-1"},oe={colspan:3},le={class:"d-flex align-content-center flex-nowrap"},ne={class:"d-flex mr-1"},re={class:"mx-1"},ie=o("td",null,null,-1);function de(e,t,k,m,i,f){const _=c("TaskFilter"),N=c("Task"),T=c("Job"),S=c("v-data-table-footer"),O=c("v-data-table"),b=z("cylc-object");return u(),v(F,{fluid:"",class:"c-table ma-0 pa-2 h-100 flex-column d-flex"},{default:l(()=>[n(D,{"no-gutters":"",class:"d-flex flex-wrap flex-grow-0"},{default:l(()=>[k.filterable?(u(),v(J,{key:0,class:""},{default:l(()=>[n(_,{modelValue:i.tasksFilter,"onUpdate:modelValue":t[0]||(t[0]=s=>i.tasksFilter=s)},null,8,["modelValue"])]),_:1})):M("",!0)]),_:1}),n(D,{"no-gutters":"",class:"flex-grow-1 position-relative"},{default:l(()=>[n(J,{cols:"12",class:"mh-100 position-relative"},{default:l(()=>[n(F,{fluid:"",class:"ma-0 pa-0 w-100 h-100 left-0 top-0 position-absolute pt-2"},{default:l(()=>[n(O,{headers:e.$options.headers,items:f.filteredTasks,"multi-sort":"","sort-by":i.sortBy,"show-expand":"",density:"compact","items-per-page":i.itemsPerPage,"onUpdate:itemsPerPage":t[1]||(t[1]=s=>i.itemsPerPage=s)},{"item.task.name":l(({item:s})=>{var a,d,h,x,P,C;return[o("div",te,[o("div",se,[y(n(N,{task:s.value.task.node,startTime:(d=(a=s.value.latestJob)==null?void 0:a.node)==null?void 0:d.startedTime},null,8,["task","startTime"]),[[b,s.value.task]])]),o("div",ae,[y(n(T,{status:(x=(h=s.value.latestJob)==null?void 0:h.node)==null?void 0:x.state,"previous-state":(C=(P=s.value.previousJob)==null?void 0:P.node)==null?void 0:C.state},null,8,["status","previous-state"]),[[b,s.value.task]])]),o("div",null,r(s.value.task.name),1)])]}),"item.task.node.task.meanElapsedTime":l(({item:s})=>[o("td",null,r(f.dtMean(s.value.task)),1)]),"item.data-table-expand":l(({item:s,toggleExpand:a,isExpanded:d})=>[n(q,{onClick:h=>a(s),icon:"",variant:"text",size:"small",style:L({visibility:(s.value.task.children||[]).length?null:"hidden",transform:d(s)?"rotate(180deg)":null})},{default:l(()=>[n(U,{icon:e.$options.icons.mdiChevronDown,size:"large"},null,8,["icon"])]),_:2},1032,["onClick","style"])]),"expanded-row":l(({item:s})=>[(u(!0),g(K,null,G(s.value.task.children,(a,d)=>(u(),g("tr",{key:a.id,class:"expanded-row bg-grey-lighten-5"},[o("td",oe,[o("div",le,[o("div",ne,[y((u(),v(T,{key:`${a.id}-summary-${d}`,status:a.node.state,style:{"margin-left":"1.3em"}},null,8,["status"])),[[b,a]]),o("span",re,"#"+r(a.node.submitNum),1)])])]),o("td",null,r(a.node.platform),1),o("td",null,r(a.node.jobRunnerName),1),o("td",null,r(a.node.jobId),1),o("td",null,r(a.node.submittedTime),1),o("td",null,r(a.node.startedTime),1),o("td",null,r(a.node.finishedTime),1),ie]))),128))]),bottom:l(()=>[n(S,{itemsPerPageOptions:e.$options.itemsPerPageOptions},null,8,["itemsPerPageOptions"])]),_:1},8,["headers","items","sort-by","items-per-page"])]),_:1})]),_:1})]),_:1})]),_:1})}const ce=I(ee,[["render",de]]),ue={name:"Table",mixins:[j,W],components:{TableComponent:ce},head(){return{title:H("App.workflow",{name:this.workflowName})}},computed:{...Q("workflows",["cylcTree"]),...X("workflows",["getNodes"]),workflowIDs(){return[this.workflowId]},workflows(){return this.getNodes("workflow",this.workflowIDs)},tasks(){const e=[];for(const t of this.workflows)for(const k of t.children)for(const m of k.children)e.push({task:m,latestJob:m.children[0],previousJob:m.children[1]});return e},query(){return new Y(Z,this.variables,"workflow",[],!0,!0)}}},me={class:"h-100"};function pe(e,t,k,m,i,f){const _=c("TableComponent");return u(),g("div",me,[n(_,{tasks:f.tasks,ref:"table0",key:"table0"},null,8,["tasks"])])}const _e=I(ue,[["render",pe]]);export{_e as default};
