{"version":3,"file":"baseCollection.js","names":["RB","BaseCollection","Backbone","Collection","extend","fetch","options","arguments","length","undefined","context","_","isFunction","success","error","console","warn","promiseToCallbacks","newOptions","Promise","resolve","reject","prototype","call","defaults","result","model","xhr","BackboneError","sync","method","storeAPIError"],"sources":["../../../../../static/rb/js/collections/baseCollection.es6.js"],"sourcesContent":["/**\n * The base class used for Review Board collections.\n *\n * This is a thin subclass over Backbone.Collection that just provides\n * some useful additional abilities.\n */\nRB.BaseCollection = Backbone.Collection.extend({\n    /**\n     * Fetch models from the server.\n     *\n     * This behaves just like Backbone.Collection.fetch, except it\n     * takes a context parameter for callbacks and can return promises.\n     *\n     * Version Changed:\n     *     5.0:\n     *     This method was changed to return a promise. Using callbacks instead\n     *     of the promise is deprecated, and will be removed in Review Board\n     *     6.0.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the fetch operation.\n     *\n     *     context (object):\n     *         Context to be used when calling callbacks.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise which resolves when the fetch operation is complete.\n     */\n    fetch: function(options={}, context=undefined) {\n        if (_.isFunction(options.success) ||\n            _.isFunction(options.error)) {\n            console.warn('RB.BaseCollection.fetch was called using ' +\n                         'callbacks. Callers should be updated to use ' +\n                         'promises instead.');\n            return RB.promiseToCallbacks(\n                options, context, newOptions => this.fetch(newOptions));\n        }\n\n        return new Promise((resolve, reject) => {\n            Backbone.Collection.prototype.fetch.call(this, _.defaults({\n                success: result => resolve(result),\n                error: (model, xhr, options) => reject(\n                    new BackboneError(model, xhr, options)),\n            }, options));\n        });\n    },\n\n    /**\n     * Handle all AJAX communication for the collection.\n     *\n     * Backbone.js will internally call the model's sync function to\n     * communicate with the server, which usually uses Backbone.sync.\n     *\n     * This will parse error response from Review Board so we can provide\n     * a more meaningful error callback.\n     *\n     * Args:\n     *     method (string):\n     *         The HTTP method to use for the AJAX request.\n     *\n     *     model (object):\n     *         The model to sync.\n     *\n     *     options (object):\n     *         Options for the sync operation.\n     */\n    sync(method, model, options={}) {\n        return Backbone.sync.call(this, method, model, _.defaults({\n            error: xhr => {\n                RB.storeAPIError(xhr);\n\n                if (_.isFunction(options.error)) {\n                    options.error(xhr);\n                }\n            }\n        }, options));\n    }\n});\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,cAAc,GAAGC,QAAQ,CAACC,UAAU,CAACC,MAAM,CAAC;EAC3C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,KAAK,EAAE,SAAAA,CAAA,EAAwC;IAAA,IAA/BC,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAC,CAAC,CAAC;IAAA,IAAEG,OAAO,GAAAH,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAACE,SAAS;IACzC,IAAIE,CAAC,CAACC,UAAU,CAACN,OAAO,CAACO,OAAO,CAAC,IAC7BF,CAAC,CAACC,UAAU,CAACN,OAAO,CAACQ,KAAK,CAAC,EAAE;MAC7BC,OAAO,CAACC,IAAI,CAAC,2CAA2C,GAC3C,8CAA8C,GAC9C,mBAAmB,CAAC;MACjC,OAAOhB,EAAE,CAACiB,kBAAkB,CACxBX,OAAO,EAAEI,OAAO,EAAEQ,UAAU,IAAI,IAAI,CAACb,KAAK,CAACa,UAAU,CAAC,CAAC;IAC/D;IAEA,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACpCnB,QAAQ,CAACC,UAAU,CAACmB,SAAS,CAACjB,KAAK,CAACkB,IAAI,CAAC,IAAI,EAAEZ,CAAC,CAACa,QAAQ,CAAC;QACtDX,OAAO,EAAEY,MAAM,IAAIL,OAAO,CAACK,MAAM,CAAC;QAClCX,KAAK,EAAEA,CAACY,KAAK,EAAEC,GAAG,EAAErB,OAAO,KAAKe,MAAM,CAClC,IAAIO,aAAa,CAACF,KAAK,EAAEC,GAAG,EAAErB,OAAO,CAAC;MAC9C,CAAC,EAAEA,OAAO,CAAC,CAAC;IAChB,CAAC,CAAC;EACN,CAAC;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIuB,IAAIA,CAACC,MAAM,EAAEJ,KAAK,EAAc;IAAA,IAAZpB,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAC,CAAC,CAAC;IAC1B,OAAOL,QAAQ,CAAC2B,IAAI,CAACN,IAAI,CAAC,IAAI,EAAEO,MAAM,EAAEJ,KAAK,EAAEf,CAAC,CAACa,QAAQ,CAAC;MACtDV,KAAK,EAAEa,GAAG,IAAI;QACV3B,EAAE,CAAC+B,aAAa,CAACJ,GAAG,CAAC;QAErB,IAAIhB,CAAC,CAACC,UAAU,CAACN,OAAO,CAACQ,KAAK,CAAC,EAAE;UAC7BR,OAAO,CAACQ,KAAK,CAACa,GAAG,CAAC;QACtB;MACJ;IACJ,CAAC,EAAErB,OAAO,CAAC,CAAC;EAChB;AACJ,CAAC,CAAC"}