[build-system]
# higher versions of setuptools are incompatible with gym==0.21, required by stable_baselines3
requires = ["setuptools==65.5", "wheel==0.40.0", "setuptools_scm[toml]>=6.2"]
build-backend = "setuptools.build_meta"

[project]
name = "eta_utility"
authors = [
    {"name" = "Technical University of Darmstadt, Institute for Production Management, Technology and Machine Tools (PTW).", "email" = "info@ptw.tu-darmstadt.de"}
]
description = "A framework for researching energy optimization of factory operations"
keywords = [
    "connectors","servers","simulators","industrial energy optimization","rolling horizon optimization"
]
license = {file = "LICENSE"}
# We're using some functionality from python 3.7 (therefore this is the minimum)
# and pytorch does not support Versions >3.10 (therefore this is the maximum).
requires-python = ">=3.8, <3.11"
classifiers = [
    "License :: OSI Approved :: BSD License",
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "Intended Audience :: Science/Research",
    "Intended Audience :: Manufacturing",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
    "Topic :: Software Development :: Libraries",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3 :: Only",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10"
]
dynamic = ["version", "readme"]
dependencies = [
    "attrs",
    "python-dateutil",
    "numpy",
    "pandas",
    "xlrd",
    "lxml",
    "requests",
    "opcua",
    "pyModbusTCP==0.2.0",
    "cryptography",
    # Lower versions of fmpy have problems with setting parameters during initialization:
    "fmpy>=0.3.5",
]

[tool.setuptools.dynamic]
version = {attr = "eta_utility._version.__version__"}
readme = {file = ["README.rst", "LICENSE"]}

[project.urls]
Homepage = "https://www.ptw.tu-darmstadt.de"
Documentation = "https://eta-utility.readthedocs.io/"
Source = "https://github.com/PTW-TUDa/eta_utility/"
Issues = "https://git.ptw.maschinenbau.tu-darmstadt.de/eta-fabrik/public/eta-utility/-/issues"

[tool.setuptools.packages.find]
include = ["eta_utility*"]
exclude = [
    "test*",
    "docs*",
    "examples*"
]

[tool.setuptools]
include-package-data = true

[tool.setuptools.package-data]
eta_utility = ["eta_utility/py.typed", "*.jl", "EtaUtility*"]

[tool.setuptools.exclude-package-data]
eta_utility = ["test", "docs", "examples"]

[project.scripts]
    install-julia = "eta_utility:install_julia"

[project.optional-dependencies]
"ETA_X" = [
    "gym==0.21", # Fixed to 0.21 because of stable_baselines
    "torch",
    "stable_baselines3>=1.8,<1.9",
    "tensorboard",
    # The MPCBasic agent currently does not support pyomo version 6:
    "pyomo>=6"
]
"EXAMPLES" = [
    # Requirements for the examples
    "matplotlib",
    "keyboard",
    "pygame",
    "pyglet",
    "onnxruntime"
]
"DEVELOP" = [
    # Repeat requirements from ETA_X
    "gym==0.21",
    "torch",
    "stable_baselines3>=1.8,<1.9", # Many breaking changes in 1.7 and switched gym to gymnasium in 2.0
    "tensorboard",
    "pyomo>=6",
    # Repeat requirements for the examples
    "matplotlib",
    "keyboard",
    "pygame",
    "pyglet",
    "onnxruntime",
    # Specific requirements for tests
    "pytest",
    "pytest-cov",
    "openpyxl",
    # Specific requirements for development
    "sphinx",
    "sphinx_rtd_theme",
    "pre-commit",
    "black>=23.7,<23.8",
    "blacken-docs>=1.16,<1.17",
    "isort>=5.12,<5.13",
    "pyupgrade>=3.10,<3.11",
    # MyPy requirements and typing packages
    "mypy>=1.5,<1.6",
    "types-python-dateutil",
    "types-requests",
    # Linting / Flake8 requirements and linting packages
    "flake8>=6.1,<6.2",
    "flake8-pyproject>=1.2,<1.3",
    "pyflakes>=3.1,<3.2",
    "pycodestyle>=2.11,<2.12",
    "flake8-builtins>=2.1,<2.2",
    "flake8-eradicate>=1.5,<1.6",
    "flake8-comprehensions>=3.14,<3.15",
    "flake8-mutable>=1.2,<1.3",
    "flake8-print>=5.0,<5.1",
    "flake8-pytest-style>=1.7,<1.8",
    "flake8-requirements>=1.7,<1.8",
    "pep8-naming>=0.13,<0.14",
    "flake8-rst-docstrings>=0.3,<0.4"
    # Could be inserted as a future requirement
    # flake8-simplify
]

[tool.setuptools_scm]
write_to = "eta_utility/_version.py"

[tool.black]
include = "\\.pyi?$|^eta_utility/|^test/"
exclude = "\\.xlsx?$|\\.fmu?$|test_resources/|__pycache__/|_version.py$"
line_length = 120
target_version = ["py38","py39"]

[tool.isort]
profile = "black"
multi_line_output = 3

[tool.flake8]
format = "default"
extend_exclude = [
    "docs/conf.py",
    "build",
    "dist",
    ".*/",
    "venv*/",
    ".venv*/",
    "*.mypy*/"
]
max_line_length = 120
max_complexity = 20
indent_size = 4
extend_ignore = [
    # Black introduces ' : ' whitespaces around colons.
    "E203",
    # Some ReST keywords are specific to sphinx and will not be recognized correctly:
    "RST303",
    "RST304",
    # Warnings about fixtures without return values are broken:
    "PT019",
]
per_file_ignores = [
    "__init__.py: F401"
]

[tool.mypy]
python_version = 3.8
files = ["eta_utility", "examples"]
disallow_untyped_defs = true
disallow_incomplete_defs = true
no_implicit_optional = true
warn_unused_ignores = true
warn_unreachable = true
show_column_numbers = true

exclude = [
    "^test/",
    "_version.py$"
]

[[tool.mypy.overrides]]
module = [
    "fmpy.*",
    "pandas.*",
    "gym.*",
    "opcua.*",
    "pyModbusTCP.*",
    "pyomo.*",
    "lxml.*",
    "julia.*",
    "setuptools",
    "importlib.metadata.*",
    "keyboard.*",
    "onnxruntime.*",
    "matplotlib.*",
    "torch.ao.nn.*"
]
ignore_missing_imports = true

[tool.pytest.ini_options]
addopts = "--cov-config=pyproject.toml"
log_cli = true
testpaths = [
    "test",
]

[tool.coverage.run]
source = [
    "eta_utility"
]
omit = [
    "*/venv/*",
    "*/.venv/*",
    "*/docs/*",
    "*/build/*",
    "*/dist/*",
]
