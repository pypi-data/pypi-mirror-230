(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{88289:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/analytics",function(){return s(42532)}])},14197:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return M}});var t=s(39324),n=s(4337),i=s(35250),r=s(16266),l=s(19841),o=s(60554),c=s(70079),d=s(1454),u=s(32004),f=s(94968),m=s(21389),x=s(6038),g=s(52696),h=s(75641),p=s(88327),v=s(15329),b=s(1821),y=s(82277),j=s(13090),k=s(78931);function _(){var e=(0,n._)(["max-w-5xl mx-auto w-full"]);return _=function(){return e},e}function w(e){var a=e.route,s=e.children,t=(0,o.useRouter)();return(0,i.jsx)(v.ZB,{$as:"button",className:(0,l.default)("rounded",t.route===a?"bg-gray-700":"hover:bg-gray-800"),onClick:function(){t.push(a)},children:s})}function N(e){var a=e.workspaceName,s=e.hasAdminPrivileges,n=(0,k.hz)(),l=(0,o.useRouter)(),f=(0,c.useCallback)(function(){l.push("/")},[l]);return(0,i.jsxs)("nav",{className:"p-2",children:[(0,i.jsxs)("div",{className:"mb-1 flex flex-row gap-2",children:[(0,i.jsxs)(j.MP,{onClick:f,children:[(0,i.jsx)(p.ZP,{icon:d.Ao2}),(0,i.jsx)(u.Z,(0,t._)({},P.backToChat))]}),(0,i.jsx)(j.H,{})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 py-2",children:[(0,i.jsxs)("div",{className:"my-2 flex flex-col gap-2 px-2",children:[(0,i.jsx)(x.B0,{size:"large"}),(0,i.jsx)("h2",{className:"text-lg text-gray-100",children:a})]}),(0,i.jsxs)(w,{route:"/admin",children:[(0,i.jsx)(p.ZP,{icon:r.Z}),(0,i.jsx)(u.Z,(0,t._)({},P.membersPageTitle))]}),!0===s?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(w,{route:"/admin/analytics",children:[(0,i.jsx)(p.ZP,{icon:d.orK}),(0,i.jsx)(u.Z,(0,t._)({},P.analytics))]}),n.has("workspace_admin_settings")&&(0,i.jsxs)(w,{route:"/admin/settings",children:[(0,i.jsx)(p.ZP,{icon:d.nbt}),(0,i.jsx)(u.Z,(0,t._)({},P.adminSettings))]})]}):null]})]})}function M(e){var a,s=e.mobilePageTitle,n=e.requireAdminPrivileges,r=void 0!==n&&n,l=e.children,d=(0,k.ec)(function(e){return e.currentWorkspace}),f=(0,k.$T)(),m=(0,g.Ix)(d),x=(0,o.useRouter)(),p=null!=d?(a=d.role)===h.r3.ADMIN||a===h.r3.OWNER:void 0;return(0,c.useEffect)(function(){r&&!1===p&&x.push("/admin")},[r,p,x]),(0,i.jsx)(y.Z,{showNavigation:!0,renderTitle:s,renderSidebar:(0,i.jsx)(N,{workspaceName:f?"":m,hasAdminPrivileges:p}),children:(0,i.jsxs)(L,{children:[f&&(0,i.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,i.jsx)(b.Z,{})}),!f&&!d&&(0,i.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,i.jsx)(u.Z,(0,t._)({},P.workspaceNotFound))}),!f&&d&&l]})})}var L=m.Z.div(_()),P=(0,f.vU)({workspaceNotFound:{id:"adminPage.workspaceNotFound",defaultMessage:"Workspace not found",description:"The title of the admin page."},backToChat:{id:"adminPage.backToChat",defaultMessage:"Back to chat",description:"Navigation button to return to main chat page"},membersPageTitle:{id:"adminPage.membersPageTitle",defaultMessage:"Members",description:"The title of the members page"},analytics:{id:"adminPage.analytics",defaultMessage:"Analytics",description:"Analytics sidebar item"},adminSettings:{id:"adminPage.adminSettings",defaultMessage:"Admin settings",description:"Settings sidebar item"}})},42532:function(e,a,s){"use strict";s.r(a),s.d(a,{__N_SSP:function(){return A},default:function(){return Z}});var t=s(39324),n=s(35250),i=s(21722),r=s(22830),l=s(75883),o=s(5268),c=s(65998),d=s(73413),u=s.n(d),f=s(70079),m=s(25771),x=s(70671),g=s(32004),h=s(94968),p=s(62509),v=s(99486),b=s(1821);function y(e){return j.apply(this,arguments)}function j(){return(j=(0,i._)(function(e){var a,s,t,n;return(0,l.Jh)(this,function(i){return(a=(0,r._)(e.queryKey,2))[0],t=(s=a[1]).workspaceId,n=s.accessToken,[2,v.ZP.getWorkspaceAnalytics(n,t)]})})).apply(this,arguments)}c.kL.register(c.uw,c.f$,c.od,c.jn,c.Dx,c.u,c.De);var k={BLUE:"#3a88ff",ORANGE:"#ff8052"};function _(e){var a=e.dailyData,s=(0,x.Z)(),t=(0,f.useMemo)(function(){return function(e,a){for(var s=function(a,s){var t,n;return null!==(n=null===(t=e.find(function(e){return new Date(e.date).toLocaleDateString()===a}))||void 0===t?void 0:t[s])&&void 0!==n?n:0},t=new Date(e[0].date),n=new Date(e[e.length-1].date),i=[],r=new Date(t);r<=n;r.setDate(r.getDate()+1))i.push(new Date(r).toLocaleDateString());return{labels:i,datasets:[{label:a.formatMessage(L.dailyMessagesLabel),data:i.map(function(e){return s(e,"message_count")}),borderColor:k.BLUE,fill:!1},{label:a.formatMessage(L.dailyUsersLabel),data:i.map(function(e){return s(e,"active_users_count")}),borderColor:k.ORANGE,fill:!1}]}}(a,s)},[a,s]);return(0,n.jsx)("div",{className:"rounded dark:bg-white dark:p-2",children:(0,n.jsx)(m.x1,{data:t,options:{animation:{duration:0},scales:{y:{beginAtZero:!0}}}})})}function w(e){var a=e.label,s=e.value;return(0,n.jsxs)("div",{className:"w-1/3 rounded bg-gray-50 px-4 py-2 dark:bg-gray-700",children:[(0,n.jsx)("label",{className:"text-sm text-token-text-secondary",children:a}),(0,n.jsx)("div",{className:"text-xl font-medium text-token-text-primary",children:s})]})}function N(e){var a=e.data,s=(0,x.Z)();return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-2 text-lg text-token-text-primary",children:(0,n.jsx)(g.Z,(0,t._)({},L.totals))}),(0,n.jsxs)("div",{className:"mb-12 flex gap-2",children:[(0,n.jsx)(w,{label:s.formatMessage(L.usersLabel),value:a.total_users}),(0,n.jsx)(w,{label:s.formatMessage(L.conversationsLabel),value:a.total_conversations}),(0,n.jsx)(w,{label:s.formatMessage(L.messagesLabel),value:a.total_messages})]}),a.daily_data.length>0?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-2 text-lg text-token-text-primary",children:(0,n.jsx)(g.Z,(0,t._)({},L.dailyUsage))}),(0,n.jsx)(_,{dailyData:a.daily_data})]}):null]})}function M(e){var a,s=e.currentWorkspaceId,i=(0,x.Z)(),r=(a=(0,p.kP)().session,(0,o.a)(["workspace-analytics",{workspaceId:s,accessToken:null==a?void 0:a.accessToken}],y,{enabled:(null==a?void 0:a.accessToken)!=null})).data;return(0,n.jsxs)("div",{className:"mx-auto max-w-2xl px-4 py-8",children:[(0,n.jsx)(u(),{children:(0,n.jsx)("title",{children:i.formatMessage(L.title)})}),(0,n.jsx)("div",{className:"mb-6 text-2xl font-medium text-token-text-primary",children:(0,n.jsx)(g.Z,(0,t._)({},L.title))}),void 0!==r?(0,n.jsx)(N,{data:r}):(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)(b.Z,{})})]})}var L=(0,h.vU)({title:{id:"workspaceAnalytics.title",defaultMessage:"Analytics",description:"Title of analytics page"},totals:{id:"workspaceAnalytics.totals",defaultMessage:"Totals",description:"Section header of total analytics"},usersLabel:{id:"workspaceAnalytics.usersLabel",defaultMessage:"Users",description:"Label of total user count"},conversationsLabel:{id:"workspaceAnalytics.conversationsLabel",defaultMessage:"Conversations",description:"Label of total conversations count"},messagesLabel:{id:"workspaceAnalytics.messagesLabel",defaultMessage:"Messages",description:"Label of total messages count"},dailyUsage:{id:"workspaceAnalytics.dailyUsage",defaultMessage:"Daily Usage",description:"Title of daily usage chart"},dailyMessagesLabel:{id:"workspaceAnalytics.dailyMessagesLabel",defaultMessage:"Messages",description:"Label of daily messages in chart"},dailyUsersLabel:{id:"workspaceAnalytics.dailyUsersLabel",defaultMessage:"Users",description:"Label of daily users in chart"}}),P=s(14197),A=!0;function Z(e){return(0,n.jsx)(M,(0,t._)({},e))}Z.getLayout=function(e){return(0,n.jsx)(P.default,{mobilePageTitle:"Analytics",requireAdminPrivileges:!0,children:e})}}},function(e){e.O(0,[2798,6835,8948,667,6493,9774,2888,179],function(){return e(e.s=88289)}),_N_E=e.O()}]);